function findParent(a,b){return a?a.className&&a.className.match(b)?a:findParent(a.parentNode,b):!1}function findElementPosition(a){var b=0,c=0;if(a.offsetParent)while(a.offsetParent){b+=a.offsetLeft-a.scrollLeft,c+=a.offsetTop-a.scrollTop;var d="";a.style&&a.style.position&&(d=a.style.position.toLowerCase()),d||a.currentStyle&&a.currentStyle.position&&(d=a.currentStyle.position.toLowerCase());if(d=="absolute"||d=="relative")break;while(a.parentNode!=a.offsetParent)a=a.parentNode,b-=a.scrollLeft,c-=a.scrollTop;a=a.offsetParent}else obj.x&&(b+=obj.x),obj.y&&(c+=obj.y);return{left:b,top:c}}function xhrRequest(a,b,c,d){var e=new XMLHttpRequest;b=="POST"?(e.open(b,a,!0),e.setRequestHeader("Content-type","application/x-www-form-urlencoded"),e.send(c)):(a.match(/\?/)?e.open(b,a+"&"+c,!0):e.open(b,a+"?"+c,!0),e.send()),e.onreadystatechange=function(){e.readyState==4&&(console.log("Response on "+a+" :",e,c),d(e))}}function xhrRedirectUrl(a,b){console.log("ASDASDASD");var c=new XMLHttpRequest;c.open("GET",a,!0),c.send(),console.log("Sending redirect response:",a),c.onreadystatechange=function(){console.log("Redirect response:",c)}}function prettyTime(a){a=parseInt(a);var b=parseInt(a/60),a=a%60;return a<10&&(a="0"+a),b<10&&(b=" "+b),b+":"+a}function timeToSeconds(a){return a=a.split(":"),parseInt(a[0])*60+parseInt(a[1])}function getTrackInfo(a){if(a.getAttribute("data-media-type")=="raw-file")return{file_url:a.getAttribute("data-url"),source_url:document.location.href,source_host:document.location.host,song:a.innerHTML.stripHTML().trim()||"Loading track info...",element_id:a.id,index:0};var b=findParent(a,"ex_container"),c=!1;b.className&&b.className.match("fdl")?c="free":b.className&&b.className.match("streamable")&&(c=!0),window.pageID||(window.pageID=(new Date).getTime());var d={artist:b.getAttribute("data-artist"),song:b.getAttribute("data-song"),album:b.getAttribute("data-album"),track_id:b.getAttribute("data-track-id"),index:parseInt(b.getAttribute("data-index-number")),page_id:window.pageID,source_url:document.location.href,source_host:document.location.host,element_id:a.id,streamable:c};d.song?d.type="track":d.album?d.type="album":d.type="artist";for(var e;e<d.length;e++)d[e]==undefined&&delete d[e];return d}(function(a){String.prototype.trim===a&&(String.prototype.trim=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")}),Array.prototype.reduce===a&&(Array.prototype.reduce=function(b){if(this===void 0||this===null)throw new TypeError;var c=Object(this),d=c.length>>>0,e=0,f;if(typeof b!="function")throw new TypeError;if(d==0&&arguments.length==1)throw new TypeError;if(arguments.length>=2)f=arguments[1];else do{if(e in c){f=c[e++];break}if(++e>=d)throw new TypeError}while(!0);while(e<d)e in c&&(f=b.call(a,f,c[e],e,c)),e++;return f})})();var Zepto=function(){function v(a){return{}.toString.call(a)=="[object Function]"}function w(a){return a instanceof Object}function x(a){return a instanceof Array}function y(a){return typeof a.length=="number"}function z(b){return b.filter(function(b){return b!==a&&b!==null})}function A(a){return a.length>0?[].concat.apply([],a):a}function B(a){return a.replace(/-+(.)?/g,function(a,b){return b?b.toUpperCase():""})}function C(a){return a.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/_/g,"-").toLowerCase()}function D(a){return a.filter(function(a,b,c){return c.indexOf(a)==b})}function E(a){return a in i?i[a]:i[a]=new RegExp("(^|\\s)"+a+"(\\s|$)")}function F(a,b){return typeof b=="number"&&!k[C(a)]?b+"px":b}function G(a){var b,c;return h[a]||(b=g.createElement(a),g.body.appendChild(b),c=j(b,"").getPropertyValue("display"),b.parentNode.removeChild(b),c=="none"&&(c="block"),h[a]=c),h[a]}function H(b,c){c===a&&(c=l.test(b)&&RegExp.$1),c in q||(c="*");var d=q[c];return d.innerHTML=""+b,f.call(d.childNodes)}function I(a,b){return a=a||e,a.__proto__=I.prototype,a.selector=b||"",a}function J(b,d){if(!b)return I();if(d!==a)return J(d).find(b);if(v(b))return J(g).ready(b);if(b instanceof I)return b;var e;return x(b)?e=z(b):m.indexOf(b.nodeType)>=0||b===window?(e=[b],b=null):l.test(b)?(e=H(b.trim(),RegExp.$1),b=null):b.nodeType&&b.nodeType==3?e=[b]:e=c(g,b),I(e,b)}function K(b,c){return c===a?J(b):J(b).filter(c)}function L(a,b,c,d){return v(b)?b.call(a,c,d):b}function M(a,b,c){var d=a%2?b:b.parentNode;d&&d.insertBefore(c,a?a==1?d.firstChild:a==2?b:null:b.nextSibling)}function N(a,b){b(a);for(var c in a.childNodes)N(a.childNodes[c],b)}var a,b,c,d,e=[],f=e.slice,g=window.document,h={},i={},j=g.defaultView.getComputedStyle,k={"column-count":1,columns:1,"font-weight":1,"line-height":1,opacity:1,"z-index":1,zoom:1},l=/^\s*<(\w+)[^>]*>/,m=[1,9,11],n=["after","prepend","before","append"],o=g.createElement("table"),p=g.createElement("tr"),q={tr:g.createElement("tbody"),tbody:o,thead:o,tfoot:o,td:p,th:p,"*":g.createElement("div")},r=/complete|loaded|interactive/,s=/^\.([\w-]+)$/,t=/^#([\w-]+)$/,u=/^[\w-]+$/;return J.extend=function(a){return f.call(arguments,1).forEach(function(c){for(b in c)a[b]=c[b]}),a},J.qsa=c=function(a,b){var c;return a===g&&t.test(b)?(c=a.getElementById(RegExp.$1))?[c]:e:f.call(s.test(b)?a.getElementsByClassName(RegExp.$1):u.test(b)?a.getElementsByTagName(b):a.querySelectorAll(b))},J.isFunction=v,J.isObject=w,J.isArray=x,J.inArray=function(a,b,c){return e.indexOf.call(b,a,c)},J.map=function(a,b){var c,d=[],e,f;if(y(a))for(e=0;e<a.length;e++)c=b(a[e],e),c!=null&&d.push(c);else for(f in a)c=b(a[f],f),c!=null&&d.push(c);return A(d)},J.each=function(a,b){var c,d;if(y(a)){for(c=0;c<a.length;c++)if(b.call(a[c],c,a[c])===!1)return a}else for(d in a)if(b.call(a[d],d,a[d])===!1)return a;return a},J.fn={forEach:e.forEach,reduce:e.reduce,push:e.push,indexOf:e.indexOf,concat:e.concat,map:function(a){return J.map(this,function(b,c){return a.call(b,c,b)})},slice:function(){return J(f.apply(this,arguments))},ready:function(a){return r.test(g.readyState)?a(J):g.addEventListener("DOMContentLoaded",function(){a(J)},!1),this},get:function(b){return b===a?this:this[b]},size:function(){return this.length},remove:function(){return this.each(function(){this.parentNode!=null&&this.parentNode.removeChild(this)})},each:function(a){return this.forEach(function(b,c){a.call(b,c,b)}),this},filter:function(a){return J([].filter.call(this,function(b){return b.parentNode&&c(b.parentNode,a).indexOf(b)>=0}))},end:function(){return this.prevObject||J()},andSelf:function(){return this.add(this.prevObject||J())},add:function(a,b){return J(D(this.concat(J(a,b))))},is:function(a){return this.length>0&&J(this[0]).filter(a).length>0},not:function(b){var c=[];if(v(b)&&b.call!==a)this.each(function(a){b.call(this,a)||c.push(this)});else{var d=typeof b=="string"?this.filter(b):y(b)&&v(b.item)?f.call(b):J(b);this.forEach(function(a){d.indexOf(a)<0&&c.push(a)})}return J(c)},eq:function(a){return a===-1?this.slice(a):this.slice(a,+a+1)},first:function(){var a=this[0];return a&&!w(a)?a:J(a)},last:function(){var a=this[this.length-1];return a&&!w(a)?a:J(a)},find:function(a){var b;return this.length==1?b=c(this[0],a):b=this.map(function(){return c(this,a)}),J(b)},closest:function(a,b){var d=this[0],e=c(b||g,a);e.length||(d=null);while(d&&e.indexOf(d)<0)d=d!==b&&d!==g&&d.parentNode;return J(d)},parents:function(a){var b=[],c=this;while(c.length>0)c=J.map(c,function(a){if((a=a.parentNode)&&a!==g&&b.indexOf(a)<0)return b.push(a),a});return K(b,a)},parent:function(a){return K(D(this.pluck("parentNode")),a)},children:function(a){return K(this.map(function(){return f.call(this.children)}),a)},siblings:function(a){return K(this.map(function(a,b){return f.call(b.parentNode.children).filter(function(a){return a!==b})}),a)},empty:function(){return this.each(function(){this.innerHTML=""})},pluck:function(a){return this.map(function(){return this[a]})},show:function(){return this.each(function(){this.style.display=="none"&&(this.style.display=null),j(this,"").getPropertyValue("display")=="none"&&(this.style.display=G(this.nodeName))})},replaceWith:function(a){return this.each(function(){J(this).before(a).remove()})},wrap:function(a){return this.each(function(){J(this).wrapAll(J(a)[0].cloneNode(!1))})},wrapAll:function(a){return this[0]&&(J(this[0]).before(a=J(a)),a.append(this)),this},unwrap:function(){return this.parent().each(function(){J(this).replaceWith(J(this).children())}),this},hide:function(){return this.css("display","none")},toggle:function(b){return(b===a?this.css("display")=="none":b)?this.show():this.hide()},prev:function(){return J(this.pluck("previousElementSibling"))},next:function(){return J(this.pluck("nextElementSibling"))},html:function(b){return b===a?this.length>0?this[0].innerHTML:null:this.each(function(a){var c=this.innerHTML;J(this).empty().append(L(this,b,a,c))})},text:function(b){return b===a?this.length>0?this[0].textContent:null:this.each(function(){this.textContent=b})},attr:function(c,d){var e;return typeof c=="string"&&d===a?this.length==0?a:c=="value"&&this[0].nodeName=="INPUT"?this.val():!(e=this[0].getAttribute(c))&&c in this[0]?this[0][c]:e:this.each(function(a){if(w(c))for(b in c)this.setAttribute(b,c[b]);else this.setAttribute(c,L(this,d,a,this.getAttribute(c)))})},removeAttr:function(a){return this.each(function(){this.removeAttribute(a)})},data:function(a,b){return this.attr("data-"+a,b)},val:function(b){return b===a?this.length>0?this[0].value:null:this.each(function(a){this.value=L(this,b,a,this.value)})},offset:function(){if(this.length==0)return null;var a=this[0].getBoundingClientRect();return{left:a.left+window.pageXOffset,top:a.top+window.pageYOffset,width:a.width,height:a.height}},css:function(c,d){if(d===a&&typeof c=="string")return this.length==0?a:this[0].style[B(c)]||j(this[0],"").getPropertyValue(c);var e="";for(b in c)e+=C(b)+":"+F(b,c[b])+";";return typeof c=="string"&&(e=C(c)+":"+F(c,d)),this.each(function(){this.style.cssText+=";"+e})},index:function(a){return a?this.indexOf(J(a)[0]):this.parent().children().indexOf(this[0])},hasClass:function(a){return this.length<1?!1:E(a).test(this[0].className)},addClass:function(a){return this.each(function(b){d=[];var c=this.className,e=L(this,a,b,c);e.split(/\s+/g).forEach(function(a){J(this).hasClass(a)||d.push(a)},this),d.length&&(this.className+=(c?" ":"")+d.join(" "))})},removeClass:function(b){return this.each(function(c){if(b===a)return this.className="";d=this.className,L(this,b,c,d).split(/\s+/g).forEach(function(a){d=d.replace(E(a)," ")}),this.className=d.trim()})},toggleClass:function(b,c){return this.each(function(d){var e=L(this,b,d,this.className);(c===a?!J(this).hasClass(e):c)?J(this).addClass(e):J(this).removeClass(e)})}},"filter,add,not,eq,first,last,find,closest,parents,parent,children,siblings".split(",").forEach(function(a){var b=J.fn[a];J.fn[a]=function(){var a=b.apply(this,arguments);return a.prevObject=this,a}}),["width","height"].forEach(function(b){J.fn[b]=function(c){var d,e=b.replace(/./,function(a){return a[0].toUpperCase()});return c===a?this[0]==window?window["inner"+e]:this[0]==g?g.documentElement["offset"+e]:(d=this.offset())&&d[b]:this.each(function(a){var d=J(this);d.css(b,L(this,c,a,d[b]()))})}}),n.forEach(function(a,b){J.fn[a]=function(a){var c=w(a)?a:H(a);if(!("length"in c)||c.nodeType)c=[c];if(c.length<1)return this;var d=this.length,e=d>1,f=b<2;return this.each(function(a,g){for(var h=0;h<c.length;h++){var i=c[f?c.length-h-1:h];N(i,function(a){a.nodeName!=null&&a.nodeName.toUpperCase()==="SCRIPT"&&(!a.type||a.type==="text/javascript")&&window.eval.call(window,a.innerHTML)}),e&&a<d-1&&(i=i.cloneNode(!0)),M(b,g,i)}})};var c=b%2?a+"To":"insert"+(b?"Before":"After");J.fn[c]=function(b){return J(b)[a](this),this}}),I.prototype=J.fn,J}();window.Zepto=Zepto,"$"in window||(window.$=Zepto),function(a){function f(a){return a._zid||(a._zid=d++)}function g(a,b,d,e){b=h(b);if(b.ns)var g=i(b.ns);return(c[f(a)]||[]).filter(function(a){return a&&(!b.e||a.e==b.e)&&(!b.ns||g.test(a.ns))&&(!d||a.fn==d)&&(!e||a.sel==e)})}function h(a){var b=(""+a).split(".");return{e:b[0],ns:b.slice(1).sort().join(" ")}}function i(a){return new RegExp("(?:^| )"+a.replace(" "," .* ?")+"(?: |$)")}function j(b,c,d){a.isObject(b)?a.each(b,d):b.split(/\s/).forEach(function(a){d(a,c)})}function k(b,d,e,g,i){var k=f(b),l=c[k]||(c[k]=[]);j(d,e,function(c,d){var e=i&&i(d,c),f=e||d,j=function(a){var c=f.apply(b,[a].concat(a.data));return c===!1&&a.preventDefault(),c},k=a.extend(h(c),{fn:d,proxy:j,sel:g,del:e,i:l.length});l.push(k),b.addEventListener(k.e,j,!1)})}function l(a,b,d,e){var h=f(a);j(b||"",d,function(b,d){g(a,b,d,e).forEach(function(b){delete c[h][b.i],a.removeEventListener(b.e,b.proxy,!1)})})}function p(b){var c=a.extend({originalEvent:b},b);return a.each(o,function(a,d){c[a]=function(){return this[d]=m,b[a].apply(b,arguments)},c[d]=n}),c}function q(a){if(!("defaultPrevented"in a)){a.defaultPrevented=!1;var b=a.preventDefault;a.preventDefault=function(){this.defaultPrevented=!0,b.call(this)}}}var b=a.qsa,c={},d=1,e={};e.click=e.mousedown=e.mouseup=e.mousemove="MouseEvents",a.event={add:k,remove:l},a.fn.bind=function(a,b){return this.each(function(){k(this,a,b)})},a.fn.unbind=function(a,b){return this.each(function(){l(this,a,b)})},a.fn.one=function(a,b){return this.each(function(c,d){k(this,a,b,null,function(a,b){return function(){var c=a.apply(d,arguments);return l(d,b,a),c}})})};var m=function(){return!0},n=function(){return!1},o={preventDefault:"isDefaultPrevented",stopImmediatePropagation:"isImmediatePropagationStopped",stopPropagation:"isPropagationStopped"};a.fn.delegate=function(b,c,d){return this.each(function(e,f){k(f,c,d,b,function(c){return function(d){var e,g=a(d.target).closest(b,f).get(0);if(g)return e=a.extend(p(d),{currentTarget:g,liveFired:f}),c.apply(g,[e].concat([].slice.call(arguments,1)))}})})},a.fn.undelegate=function(a,b,c){return this.each(function(){l(this,b,c,a)})},a.fn.live=function(b,c){return a(document.body).delegate(this.selector,b,c),this},a.fn.die=function(b,c){return a(document.body).undelegate(this.selector,b,c),this},a.fn.on=function(b,c,d){return c===undefined||a.isFunction(c)?this.bind(b,c):this.delegate(c,b,d)},a.fn.off=function(b,c,d){return c===undefined||a.isFunction(c)?this.unbind(b,c):this.undelegate(c,b,d)},a.fn.trigger=function(b,c){return typeof b=="string"&&(b=a.Event(b)),q(b),b.data=c,this.each(function(){this.dispatchEvent(b)})},a.fn.triggerHandler=function(b,c){var d,e;return this.each(function(f,h){d=p(typeof b=="string"?a.Event(b):b),d.data=c,d.target=h,a.each(g(h,b.type||b),function(a,b){e=b.proxy(d);if(d.isImmediatePropagationStopped())return!1})}),e},"focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout change select keydown keypress keyup error".split(" ").forEach(function(b){a.fn[b]=function(a){return this.bind(b,a)}}),["focus","blur"].forEach(function(b){a.fn[b]=function(a){if(a)this.bind(b,a);else if(this.length)try{this.get(0)[b]()}catch(c){}return this}}),a.Event=function(a,b){var c=document.createEvent(e[a]||"Events"),d=!0;if(b)for(var f in b)f=="bubbles"?d=!!b[f]:c[f]=b[f];return c.initEvent(a,d,!0,null,null,null,null,null,null,null,null,null,null,null,null),c}}(Zepto),function(a){function b(a){var b=this.os={},c=this.browser={},d=a.match(/WebKit\/([\d.]+)/),e=a.match(/(Android)\s+([\d.]+)/),f=a.match(/(iPad).*OS\s([\d_]+)/),g=!f&&a.match(/(iPhone\sOS)\s([\d_]+)/),h=a.match(/(webOS|hpwOS)[\s\/]([\d.]+)/),i=h&&a.match(/TouchPad/),j=a.match(/(BlackBerry).*Version\/([\d.]+)/);d&&(c.version=d[1]),c.webkit=!!d,e&&(b.android=!0,b.version=e[2]),g&&(b.ios=!0,b.version=g[2].replace(/_/g,"."),b.iphone=!0),f&&(b.ios=!0,b.version=f[2].replace(/_/g,"."),b.ipad=!0),h&&(b.webos=!0,b.version=h[2]),i&&(b.touchpad=!0),j&&(b.blackberry=!0,b.version=j[2])}b.call(a,navigator.userAgent),a.__detect=b}(Zepto),function(a,b){function k(a){return a.toLowerCase()}function l(a){return d?d+a:k(a)}var c="",d,e,f,g={Webkit:"webkit",Moz:"",O:"o",ms:"MS"},h=window.document,i=h.createElement("div"),j=/^((translate|rotate|scale)(X|Y|Z|3d)?|matrix(3d)?|perspective|skew(X|Y)?)$/i;a.each(g,function(a,e){if(i.style[a+"TransitionProperty"]!==b)return c="-"+k(a)+"-",d=e,!1}),a.fx={off:d===b&&i.style.transitionProperty===b,cssPrefix:c,transitionEnd:l("TransitionEnd"),animationEnd:l("AnimationEnd")},a.fn.animate=function(b,c,d,e){return a.isObject(c)&&(d=c.easing,e=c.complete,c=c.duration),c&&(c/=1e3),this.anim(b,c,d,e)},a.fn.anim=function(d,e,f,g){var h,i={},k,l=this,m,n=a.fx.transitionEnd;e===b&&(e=.4),a.fx.off&&(e=0);if(typeof d=="string")i[c+"animation-name"]=d,i[c+"animation-duration"]=e+"s",n=a.fx.animationEnd;else{for(k in d)j.test(k)?(h||(h=[]),h.push(k+"("+d[k]+")")):i[k]=d[k];h&&(i[c+"transform"]=h.join(" ")),a.fx.off||(i[c+"transition"]="all "+e+"s "+(f||""))}return m=function(){var b={};b[c+"transition"]=b[c+"animation-name"]="none",a(this).css(b),g&&g.call(this)},e>0&&this.one(n,m),setTimeout(function(){l.css(i),e<=0&&setTimeout(function(){l.each(function(){m.call(this)})},0)},0),this},i=null}(Zepto),function(a){function g(b,c,d){var e=a.Event(c);return a(b).trigger(e,d),!e.defaultPrevented}function h(a,b,c,e){if(a.global)return g(b||d,c,e)}function i(b){b.global&&a.active++===0&&h(b,null,"ajaxStart")}function j(b){b.global&&!--a.active&&h(b,null,"ajaxStop")}function k(a,b){var c=b.context;if(b.beforeSend.call(c,a,b)===!1||h(b,c,"ajaxBeforeSend",[a,b])===!1)return!1;h(b,c,"ajaxSend",[a,b])}function l(a,b,c){var d=c.context,e="success";c.success.call(d,a,e,b),h(c,d,"ajaxSuccess",[b,c,a]),n(e,b,c)}function m(a,b,c,d){var e=d.context;d.error.call(e,c,b,a),h(d,e,"ajaxError",[c,d,a]),n(b,c,d)}function n(a,b,c){var d=c.context;c.complete.call(d,b,a),h(c,d,"ajaxComplete",[b,c]),j(c)}function o(){}function q(b,d,e,f){var g=a.isArray(d);a.each(d,function(d,h){f&&(d=e?f:f+"["+(g?"":d)+"]"),!f&&g?b.add(h.name,h.value):(e?a.isArray(h):c(h))?q(b,h,e,d):b.add(d,h)})}var b=0,c=a.isObject,d=window.document,e,f;a.active=0,a.ajaxJSONP=function(e){var f="jsonp"+ ++b,g=d.createElement("script"),h=function(){a(g).remove(),f in window&&(window[f]=o),n("abort",i,e)},i={abort:h},j;return window[f]=function(b){clearTimeout(j),a(g).remove(),delete window[f],l(b,i,e)},c(e.data)&&(e.data=a.param(e.data)),url=e.url.replace(/=\?/,"="+f),e.data&&(url+="&"+e.data),g.src=url,a("head").append(g),e.timeout>0&&(j=setTimeout(function(){i.abort(),n("timeout",i,e)},e.timeout)),i},a.ajaxSettings={type:"GET",beforeSend:o,success:o,error:o,complete:o,context:null,global:!0,xhr:function(){return new window.XMLHttpRequest},accepts:{script:"text/javascript, application/javascript",json:"application/json",xml:"application/xml, text/xml",html:"text/html",text:"text/plain"},crossDomain:!1,timeout:0},a.ajax=function(b){var d=a.extend({},b||{});for(e in a.ajaxSettings)d[e]===undefined&&(d[e]=a.ajaxSettings[e]);i(d),d.crossDomain||(d.crossDomain=/^([\w-]+:)?\/\/([^\/]+)/.test(d.url)&&RegExp.$2!=window.location.host);if(/=\?/.test(d.url))return a.ajaxJSONP(d);if(d.dataType&&d.dataType.match(/jsonp/i))return d.url.match(/\?.*=/)?d.url+="&callback=?":d.url+="?callback=?",a.ajaxJSONP(d);d.url||(d.url=window.location.toString()),d.data&&!d.contentType&&(d.contentType="application/x-www-form-urlencoded"),c(d.data)&&(d.data=a.param(d.data));if(d.type.match(/get/i)&&d.data){var g=d.data;d.url.match(/\?.*=/)?g="&"+g:g[0]!="?"&&(g="?"+g),d.url+=g}var h=d.accepts[d.dataType],j={},n=/^([\w-]+:)\/\//.test(d.url)?RegExp.$1:window.location.protocol,p=a.ajaxSettings.xhr(),q;d.crossDomain||(j["X-Requested-With"]="XMLHttpRequest"),h&&(j.Accept=h),d.headers=a.extend(j,d.headers||{}),p.onreadystatechange=function(){if(p.readyState==4){clearTimeout(q);var a,b=!1;if(p.status>=200&&p.status<300||p.status==0&&n=="file:"){if(h=="application/json"&&!/^\s*$/.test(p.responseText))try{a=JSON.parse(p.responseText)}catch(c){b=c}else a=p.responseText;b?m(b,"parsererror",p,d):l(a,p,d)}else m(null,"error",p,d)}};var r="async"in d?d.async:!0;p.open(d.type,d.url,r),d.contentType&&(d.headers["Content-Type"]=d.contentType);for(f in d.headers)p.setRequestHeader(f,d.headers[f]);return k(p,d)===!1?(p.abort(),!1):(d.timeout>0&&(q=setTimeout(function(){p.onreadystatechange=o,p.abort(),m(null,"timeout",p,d)},d.timeout)),p.send(d.data),p)},a.get=function(b,c){return a.ajax({url:b,success:c})},a.post=function(b,c,d,e){return a.isFunction(c)&&(e=e||d,d=c,c=null),a.ajax({type:"POST",url:b,data:c,success:d,dataType:e})},a.getJSON=function(b,c){return a.ajax({url:b,success:c,dataType:"json"})},a.fn.load=function(b,c){if(!this.length)return this;var e=this,f=b.split(/\s/),g;return f.length>1&&(b=f[0],g=f[1]),a.get(b,function(b){e.html(g?a(d.createElement("div")).html(b).find(g).html():b),c&&c.call(e)}),this};var p=encodeURIComponent;a.param=function(a,b){var c=[];return c.add=function(a,b){this.push(p(a)+"="+p(b))},q(c,a,b),c.join("&").replace("%20","+")}}(Zepto),function(a){a.fn.serializeArray=function(){var b=[],c;return a(Array.prototype.slice.call(this.get(0).elements)).each(function(){c=a(this);var d=c.attr("type");this.nodeName.toLowerCase()!="fieldset"&&!this.disabled&&d!="submit"&&d!="reset"&&d!="button"&&(d!="radio"&&d!="checkbox"||this.checked)&&b.push({name:c.attr("name"),value:c.val()})}),b},a.fn.serialize=function(){var a=[];return this.serializeArray().forEach(function(b){a.push(encodeURIComponent(b.name)+"="+encodeURIComponent(b.value))}),a.join("&")},a.fn.submit=function(b){if(b)this.bind("submit",b);else if(this.length){var c=a.Event("submit");this.eq(0).trigger(c),c.defaultPrevented||this.get(0).submit()}return this}}(Zepto),function(a){function d(a){return"tagName"in a?a:a.parentNode}function e(a,b,c,d){var e=Math.abs(a-b),f=Math.abs(c-d);return e>=f?a-b>0?"Left":"Right":c-d>0?"Up":"Down"}function g(){b.last&&Date.now()-b.last>=f&&(b.el.trigger("longTap"),b={})}var b={},c,f=750;a(document).ready(function(){a(document.body).bind("touchstart",function(e){var h=Date.now(),i=h-(b.last||h);b.el=a(d(e.touches[0].target)),c&&clearTimeout(c),b.x1=e.touches[0].pageX,b.y1=e.touches[0].pageY,i>0&&i<=250&&(b.isDoubleTap=!0),b.last=h,setTimeout(g,f)}).bind("touchmove",function(a){b.x2=a.touches[0].pageX,b.y2=a.touches[0].pageY}).bind("touchend",function(a){b.isDoubleTap?(b.el.trigger("doubleTap"),b={}):b.x2>0||b.y2>0?((Math.abs(b.x1-b.x2)>30||Math.abs(b.y1-b.y2)>30)&&b.el.trigger("swipe")&&b.el.trigger("swipe"+e(b.x1,b.x2,b.y1,b.y2)),b.x1=b.x2=b.y1=b.y2=b.last=0):"last"in b&&(b.el.trigger("tap"),c=setTimeout(function(){c=null,b.el.trigger("singleTap"),b={}},250))}).bind("touchcancel",function(){b={}})}),["swipe","swipeLeft","swipeRight","swipeUp","swipeDown","doubleTap","tap","singleTap","longTap"].forEach(function(b){a.fn[b]=function(a){return this.bind(b,a)}})}(Zepto);var store=function(){function h(){try{return d in b&&b[d]}catch(a){return!1}}function i(){try{return e in b&&b[e]&&b[e][b.location.hostname]}catch(a){return!1}}var a={},b=window,c=b.document,d="localStorage",e="globalStorage",f="__storejs__",g;a.disabled=!1,a.set=function(a,b){},a.get=function(a){},a.remove=function(a){},a.clear=function(){},a.transact=function(b,c){var d=a.get(b);typeof d=="undefined"&&(d={}),c(d),a.set(b,d)},a.serialize=function(a){return JSON.stringify(a)},a.deserialize=function(a){return typeof a=="undefined"||typeof a!="string"||a==="undefined"||a==="null"?undefined:JSON.parse(a)};if(h())g=b[d],a.set=function(b,c){typeof c=="undefined"||c===null?a.remove(b):g.setItem(b,a.serialize(c))},a.get=function(b){return a.deserialize(g.getItem(b))},a.remove=function(a){g.removeItem(a)},a.clear=function(){g.clear()};else if(i())g=b[e][b.location.hostname],a.set=function(b,c){g[b]=a.serialize(c)},a.get=function(b){return a.deserialize(g[b]&&g[b].value)},a.remove=function(a){delete g[a]},a.clear=function(){for(var a in g)delete g[a]};else if(c.documentElement.addBehavior){var g=c.createElement("div");function j(b){return function(){var e=Array.prototype.slice.call(arguments,0);e.unshift(g),c.body.appendChild(g),g.addBehavior("#default#userData"),g.load(d);var f=b.apply(a,e);return c.body.removeChild(g),f}}a.set=j(function(b,c,e){b.setAttribute(c,a.serialize(e)),b.save(d)}),a.get=j(function(b,c){return a.deserialize(b.getAttribute(c))}),a.remove=j(function(a,b){a.removeAttribute(b),a.save(d)}),a.clear=j(function(a){var b=a.XMLDocument.documentElement.attributes;a.load(d);for(var c=0,e;e=b[c];c++)a.removeAttribute(e.name);a.save(d)})}try{a.set(f,f),a.get(f)!=f&&(a.disabled=!0),a.remove(f)}catch(k){a.disabled=!0}return a}();typeof module!="undefined"&&(module.exports=store),function(){function a(b,c,d){if(b===c)return b!==0||1/b==1/c;if(b==null)return b===c;var e=typeof b;if(e!=typeof c)return!1;if(!b!=!c)return!1;if(v.isNaN(b))return v.isNaN(c);var f=v.isString(b),g=v.isString(c);if(f||g)return f&&g&&String(b)==String(c);f=v.isNumber(b),g=v.isNumber(c);if(f||g)return f&&g&&+b==+c;f=v.isBoolean(b),g=v.isBoolean(c);if(f||g)return f&&g&&+b==+c;f=v.isDate(b),g=v.isDate(c);if(f||g)return f&&g&&b.getTime()==c.getTime();f=v.isRegExp(b),g=v.isRegExp(c);if(f||g)return f&&g&&b.source==c.source&&b.global==c.global&&b.multiline==c.multiline&&b.ignoreCase==c.ignoreCase;if(e!="object")return!1;b._chain&&(b=b._wrapped),c._chain&&(c=c._wrapped);if(v.isFunction(b.isEqual))return b.isEqual(c);for(e=d.length;e--;)if(d[e]==b)return!0;d.push(b),e=0,f=!0;if(b.length===+b.length||c.length===+c.length){if(e=b.length,f=e==c.length)for(;e--;)if(!(f=e in b==e in c&&a(b[e],c[e],d)))break}else{for(var h in b)if(j.call(b,h)&&(e++,!(f=j.call(c,h)&&a(b[h],c[h],d))))break;if(f){for(h in c)if(j.call(c,h)&&!(e--))break;f=!e}}return d.pop(),f}var b=this,c=b._,d={},e=Array.prototype,f=Object.prototype,g=e.slice,h=e.unshift,i=f.toString,j=f.hasOwnProperty,k=e.forEach,l=e.map,m=e.reduce,n=e.reduceRight,o=e.filter,p=e.every,q=e.some,r=e.indexOf,s=e.lastIndexOf,f=Array.isArray,t=Object.keys,u=Function.prototype.bind,v=function(a){return new A(a)};typeof module!="undefined"&&module.exports?(module.exports=v,v._=v):b._=v,v.VERSION="1.2.0";var w=v.each=v.forEach=function(a,b,c){if(a!=null)if(k&&a.forEach===k)a.forEach(b,c);else if(a.length===+a.length){for(var e=0,f=a.length;e<f;e++)if(e in a&&b.call(c,a[e],e,a)===d)break}else for(e in a)if(j.call(a,e)&&b.call(c,a[e],e,a)===d)break};v.map=function(a,b,c){var d=[];return a==null?d:l&&a.map===l?a.map(b,c):(w(a,function(a,e,f){d[d.length]=b.call(c,a,e,f)}),d)},v.reduce=v.foldl=v.inject=function(a,b,c,d){var e=c!==void 0;a==null&&(a=[]);if(m&&a.reduce===m)return d&&(b=v.bind(b,d)),e?a.reduce(b,c):a.reduce(b);w(a,function(a,f,g){e?c=b.call(d,c,a,f,g):(c=a,e=!0)});if(!e)throw new TypeError("Reduce of empty array with no initial value");return c},v.reduceRight=v.foldr=function(a,b,c,d){return a==null&&(a=[]),n&&a.reduceRight===n?(d&&(b=v.bind(b,d)),c!==void 0?a.reduceRight(b,c):a.reduceRight(b)):(a=(v.isArray(a)?a.slice():v.toArray(a)).reverse(),v.reduce(a,b,c,d))},v.find=v.detect=function(a,b,c){var d;return x(a,function(a,e,f){if(b.call(c,a,e,f))return d=a,!0}),d},v.filter=v.select=function(a,b,c){var d=[];return a==null?d:o&&a.filter===o?a.filter(b,c):(w(a,function(a,e,f){b.call(c,a,e,f)&&(d[d.length]=a)}),d)},v.reject=function(a,b,c){var d=[];return a==null?d:(w(a,function(a,e,f){b.call(c,a,e,f)||(d[d.length]=a)}),d)},v.every=v.all=function(a,b,c){var e=!0;return a==null?e:p&&a.every===p?a.every(b,c):(w(a,function(a,f,g){if(!(e=e&&b.call(c,a,f,g)))return d}),e)};var x=v.some=v.any=function(a,b,c){var b=b||v.identity,e=!1;return a==null?e:q&&a.some===q?a.some(b,c):(w(a,function(a,f,g){if(e|=b.call(c,a,f,g))return d}),!!e)};v.include=v.contains=function(a,b){var c=!1;return a==null?c:r&&a.indexOf===r?a.indexOf(b)!=-1:(x(a,function(a){if(c=a===b)return!0}),c)},v.invoke=function(a,b){var c=g.call(arguments,2);return v.map(a,function(a){return(b.call?b||a:a[b]).apply(a,c)})},v.pluck=function(a,b){return v.map(a,function(a){return a[b]})},v.max=function(a,b,c){if(!b&&v.isArray(a))return Math.max.apply(Math,a);if(!b&&v.isEmpty(a))return-Infinity;var d={computed:-Infinity};return w(a,function(a,e,f){e=b?b.call(c,a,e,f):a,e>=d.computed&&(d={value:a,computed:e})}),d.value},v.min=function(a,b,c){if(!b&&v.isArray(a))return Math.min.apply(Math,a);if(!b&&v.isEmpty(a))return Infinity;var d={computed:Infinity};return w(a,function(a,e,f){e=b?b.call(c,a,e,f):a,e<d.computed&&(d={value:a,computed:e})}),d.value},v.shuffle=function(a){var b=[],c;return w(a,function(a,d){d==0?b[0]=a:(c=Math.floor(Math.random()*(d+1)),b[d]=b[c],b[c]=a)}),b},v.sortBy=function(a,b,c){return v.pluck(v.map(a,function(a,d,e){return{value:a,criteria:b.call(c,a,d,e)}}).sort(function(a,b){var c=a.criteria,d=b.criteria;return c<d?-1:c>d?1:0}),"value")},v.groupBy=function(a,b){var c={};return w(a,function(a,d){var e=b(a,d);(c[e]||(c[e]=[])).push(a)}),c},v.sortedIndex=function(a,b,c){c||(c=v.identity);for(var d=0,e=a.length;d<e;){var f=d+e>>1;c(a[f])<c(b)?d=f+1:e=f}return d},v.toArray=function(a){return a?a.toArray?a.toArray():v.isArray(a)?g.call(a):v.isArguments(a)?g.call(a):v.values(a):[]},v.size=function(a){return v.toArray(a).length},v.first=v.head=function(a,b,c){return b!=null&&!c?g.call(a,0,b):a[0]},v.initial=function(a,b,c){return g.call(a,0,a.length-(b==null||c?1:b))},v.last=function(a,b,c){return b!=null&&!c?g.call(a,a.length-b):a[a.length-1]},v.rest=v.tail=function(a,b,c){return g.call(a,b==null||c?1:b)},v.compact=function(a){return v.filter(a,function(a){return!!a})},v.flatten=function(a){return v.reduce(a,function(a,b){return v.isArray(b)?a.concat(v.flatten(b)):(a[a.length]=b,a)},[])},v.without=function(a){return v.difference(a,g.call(arguments,1))},v.uniq=v.unique=function(a,b,c){var c=c?v.map(a,c):a,d=[];return v.reduce(c,function(c,e,f){if(0==f||(b===!0?v.last(c)!=e:!v.include(c,e)))c[c.length]=e,d[d.length]=a[f];return c},[]),d},v.union=function(){return v.uniq(v.flatten(arguments))},v.intersection=v.intersect=function(a){var b=g.call(arguments,1);return v.filter(v.uniq(a),function(a){return v.every(b,function(b){return v.indexOf(b,a)>=0})})},v.difference=function(a,b){return v.filter(a,function(a){return!v.include(b,a)})},v.zip=function(){for(var a=g.call(arguments),b=v.max(v.pluck(a,"length")),c=Array(b),d=0;d<b;d++)c[d]=v.pluck(a,""+d);return c},v.indexOf=function(a,b,c){if(a==null)return-1;var d;if(c)return c=v.sortedIndex(a,b),a[c]===b?c:-1;if(r&&a.indexOf===r)return a.indexOf(b);for(c=0,d=a.length;c<d;c++)if(a[c]===b)return c;return-1},v.lastIndexOf=function(a,b){if(a==null)return-1;if(s&&a.lastIndexOf===s)return a.lastIndexOf(b);for(var c=a.length;c--;)if(a[c]===b)return c;return-1},v.range=function(a,b,c){arguments.length<=1&&(b=a||0,a=0);for(var c=arguments[2]||1,d=Math.max(Math.ceil((b-a)/c),0),e=0,f=Array(d);e<d;)f[e++]=a,a+=c;return f},v.bind=function(a,b){if(a.bind===u&&u)return u.apply(a,g.call(arguments,1));var c=g.call(arguments,2);return function(){return a.apply(b,c.concat(g.call(arguments)))}},v.bindAll=function(a){var b=g.call(arguments,1);return b.length==0&&(b=v.functions(a)),w(b,function(b){a[b]=v.bind(a[b],a)}),a},v.memoize=function(a,b){var c={};return b||(b=v.identity),function(){var d=b.apply(this,arguments);return j.call(c,d)?c[d]:c[d]=a.apply(this,arguments)}},v.delay=function(a,b){var c=g.call(arguments,2);return setTimeout(function(){return a.apply(a,c)},b)},v.defer=function(a){return v.delay.apply(v,[a,1].concat(g.call(arguments,1)))};var y=function(a,b,c){var d;return function(){var e=this,f=arguments,g=function(){d=null,a.apply(e,f)};c&&clearTimeout(d);if(c||!d)d=setTimeout(g,b)}};v.throttle=function(a,b){return y(a,b,!1)},v.debounce=function(a,b){return y(a,b,!0)},v.once=function(a){var b=!1,c;return function(){return b?c:(b=!0,c=a.apply(this,arguments))}},v.wrap=function(a,b){return function(){var c=[a].concat(g.call(arguments));return b.apply(this,c)}},v.compose=function(){var a=g.call(arguments);return function(){for(var b=g.call(arguments),c=a.length-1;c>=0;c--)b=[a[c].apply(this,b)];return b[0]}},v.after=function(a,b){return function(){if(--a<1)return b.apply(this,arguments)}},v.keys=t||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var b=[],c;for(c in a)j.call(a,c)&&(b[b.length]=c);return b},v.values=function(a){return v.map(a,v.identity)},v.functions=v.methods=function(a){var b=[],c;for(c in a)v.isFunction(a[c])&&b.push(c);return b.sort()},v.extend=function(a){return w(g.call(arguments,1),function(b){for(var c in b)b[c]!==void 0&&(a[c]=b[c])}),a},v.defaults=function(a){return w(g.call(arguments,1),function(b){for(var c in b)a[c]==null&&(a[c]=b[c])}),a},v.clone=function(a){return v.isArray(a)?a.slice():v.extend({},a)},v.tap=function(a,b){return b(a),a},v.isEqual=function(b,c){return a(b,c,[])},v.isEmpty=function(a){if(v.isArray(a)||v.isString(a))return a.length===0;for(var b in a)if(j.call(a,b))return!1;return!0},v.isElement=function(a){return!!a&&a.nodeType==1},v.isArray=f||function(a){return i.call(a)==="[object Array]"},v.isObject=function(a){return a===Object(a)},v.isArguments=function(a){return!!a&&!!j.call(a,"callee")},v.isFunction=function(a){return!(!a||!a.constructor||!a.call||!a.apply)},v.isString=function(a){return!!(a===""||a&&a.charCodeAt&&a.substr)},v.isNumber=function(a){return!!(a===0||a&&a.toExponential&&a.toFixed)},v.isNaN=function(a){return a!==a},v.isBoolean=function(a){return a===!0||a===!1||i.call(a)=="[object Boolean]"},v.isDate=function(a){return!(!a||!a.getTimezoneOffset||!a.setUTCFullYear)},v.isRegExp=function(a){return!(!a||!a.test||!a.exec||!a.ignoreCase&&a.ignoreCase!==!1)},v.isNull=function(a){return a===null},v.isUndefined=function(a){return a===void 0},v.noConflict=function(){return b._=c,this},v.identity=function(a){return a},v.times=function(a,b,c){for(var d=0;d<a;d++)b.call(c,d)},v.escape=function(a){return(""+a).replace(/&(?!\w+;|#\d+;|#x[\da-f]+;)/gi,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")},v.mixin=function(a){w(v.functions(a),function(b){C(b,v[b]=a[b])})};var z=0;v.uniqueId=function(a){var b=z++;return a?a+b:b},v.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g},v.template=function(a,b){var c=v.templateSettings,c="var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('"+a.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(c.escape,function(a,b){return"',_.escape("+b.replace(/\\'/g,"'")+"),'"}).replace(c.interpolate,function(a,b){return"',"+b.replace(/\\'/g,"'")+",'"}).replace(c.evaluate||null,function(a,b){return"');"+b.replace(/\\'/g,"'").replace(/[\r\n\t]/g," ")+"__p.push('"}).replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t")+"');}return __p.join('');",c=new Function("obj",c);return b?c(b):c};var A=function(a){this._wrapped=a};v.prototype=A.prototype;var B=function(a,b){return b?v(a).chain():a},C=function(a,b){A.prototype[a]=function(){var a=g.call(arguments);return h.call(a,this._wrapped),B(b.apply(v,a),this._chain)}};v.mixin(v),w("pop,push,reverse,shift,sort,splice,unshift".split(","),function(a){var b=e[a];A.prototype[a]=function(){return b.apply(this._wrapped,arguments),B(this._wrapped,this._chain)}}),w(["concat","join","slice"],function(a){var b=e[a];A.prototype[a]=function(){return B(b.apply(this._wrapped,arguments),this._chain)}}),A.prototype.chain=function(){return this._chain=!0,this},A.prototype.value=function(){return this._wrapped}}(),function(){var a=this,b=a.Backbone,c;c=typeof exports!="undefined"?exports:a.Backbone={},c.VERSION="0.5.3";var d=a._;!d&&typeof require!="undefined"&&(d=require("underscore")._);var e=a.jQuery||a.Zepto;c.noConflict=function(){return a.Backbone=b,this},c.emulateHTTP=!1,c.emulateJSON=!1,c.Events={bind:function(a,b,c){var d=this._callbacks||(this._callbacks={});return(d[a]||(d[a]=[])).push([b,c]),this},unbind:function(a,b){var c;if(a){if(c=this._callbacks)if(b){c=c[a];if(!c)return this;for(var d=0,e=c.length;d<e;d++)if(c[d]&&b===c[d][0]){c[d]=null;break}}else c[a]=[]}else this._callbacks={};return this},trigger:function(a){var b,c,d,e,f=2;if(!(c=this._callbacks))return this;for(;f--;)if(b=f?a:"all",b=c[b])for(var g=0,h=b.length;g<h;g++)(d=b[g])?(e=f?Array.prototype.slice.call(arguments,1):arguments,d[0].apply(d[1]||this,e)):(b.splice(g,1),g--,h--);return this}},c.Model=function(a,b){var c;a||(a={});if(c=this.defaults)d.isFunction(c)&&(c=c.call(this)),a=d.extend({},c,a);this.attributes={},this._escapedAttributes={},this.cid=d.uniqueId("c"),this.set(a,{silent:!0}),this._changed=!1,this._previousAttributes=d.clone(this.attributes),b&&b.collection&&(this.collection=b.collection),this.initialize(a,b)},d.extend(c.Model.prototype,c.Events,{_previousAttributes:null,_changed:!1,idAttribute:"id",initialize:function(){},toJSON:function(){return d.clone(this.attributes)},get:function(a){return this.attributes[a]},escape:function(a){var b;return(b=this._escapedAttributes[a])?b:(b=this.attributes[a],this._escapedAttributes[a]=(b==null?"":""+b).replace(/&(?!\w+;|#\d+;|#x[\da-f]+;)/gi,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;"))},has:function(a){return this.attributes[a]!=null},set:function(a,b){b||(b={});if(!a)return this;a.attributes&&(a=a.attributes);var c=this.attributes,e=this._escapedAttributes;if(!b.silent&&this.validate&&!this._performValidation(a,b))return!1;this.idAttribute in a&&(this.id=a[this.idAttribute]);var f=this._changing;this._changing=!0;for(var g in a){var h=a[g];d.isEqual(c[g],h)||(c[g]=h,delete e[g],this._changed=!0,b.silent||this.trigger("change:"+g,this,h,b))}return!f&&!b.silent&&this._changed&&this.change(b),this._changing=!1,this},unset:function(a,b){if(a in this.attributes){b||(b={});var c={};return c[a]=void 0,!b.silent&&this.validate&&!this._performValidation(c,b)?!1:(delete this.attributes[a],delete this._escapedAttributes[a],a==this.idAttribute&&delete this.id,this._changed=!0,b.silent||(this.trigger("change:"+a,this,void 0,b),this.change(b)),this)}return this},clear:function(a){a||(a={});var b,c=this.attributes,d={};for(b in c)d[b]=void 0;if(!a.silent&&this.validate&&!this._performValidation(d,a))return!1;this.attributes={},this._escapedAttributes={},this._changed=!0;if(!a.silent){for(b in c)this.trigger("change:"+b,this,void 0,a);this.change(a)}return this},fetch:function(a){a||(a={});var b=this,d=a.success;return a.success=function(c,e,f){if(!b.set(b.parse(c,f),a))return!1;d&&d(b,c)},a.error=s(a.error,b,a),(this.sync||c.sync).call(this,"read",this,a)},save:function(a,b){b||(b={});if(a&&!this.set(a,b))return!1;var d=this,e=b.success;b.success=function(a,c,f){if(!d.set(d.parse(a,f),b))return!1;e&&e(d,a,f)},b.error=s(b.error,d,b);var f=this.isNew()?"create":"update";return(this.sync||c.sync).call(this,f,this,b)},destroy:function(a){a||(a={});if(this.isNew())return this.trigger("destroy",this,this.collection,a);var b=this,d=a.success;return a.success=function(c){b.trigger("destroy",b,b.collection,a),d&&d(b,c)},a.error=s(a.error,b,a),(this.sync||c.sync).call(this,"delete",this,a)},url:function(){var a=q(this.collection)||this.urlRoot||r();return this.isNew()?a:a+(a.charAt(a.length-1)=="/"?"":"/")+encodeURIComponent(this.id)},parse:function(a){return a},clone:function(){return new this.constructor(this)},isNew:function(){return this.id==null},change:function(a){this.trigger("change",this,a),this._previousAttributes=d.clone(this.attributes),this._changed=!1},hasChanged:function(a){return a?this._previousAttributes[a]!=this.attributes[a]:this._changed},changedAttributes:function(a){a||(a=this.attributes);var b=this._previousAttributes,c=!1,e;for(e in a)d.isEqual(b[e],a[e])||(c=c||{},c[e]=a[e]);return c},previous:function(a){return!a||!this._previousAttributes?null:this._previousAttributes[a]},previousAttributes:function(){return d.clone(this._previousAttributes)},_performValidation:function(a,b){var c=this.validate(a);return c?(b.error?b.error(this,c,b):this.trigger("error",this,c,b),!1):!0}}),c.Collection=function(a,b){b||(b={}),b.comparator&&(this.comparator=b.comparator),d.bindAll(this,"_onModelEvent","_removeReference"),this._reset(),a&&this.reset(a,{silent:!0}),this.initialize.apply(this,arguments)},d.extend(c.Collection.prototype,c.Events,{model:c.Model,initialize:function(){},toJSON:function(){return this.map(function(a){return a.toJSON()})},add:function(a,b){if(d.isArray(a))for(var c=0,e=a.length;c<e;c++)this._add(a[c],b);else this._add(a,b);return this},remove:function(a,b){if(d.isArray(a))for(var c=0,e=a.length;c<e;c++)this._remove(a[c],b);else this._remove(a,b);return this},get:function(a){return a==null?null:this._byId[a.id!=null?a.id:a]},getByCid:function(a){return a&&this._byCid[a.cid||a]},at:function(a){return this.models[a]},sort:function(a){a||(a={});if(!this.comparator)throw Error("Cannot sort a set without a comparator");return this.models=this.sortBy(this.comparator),a.silent||this.trigger("reset",this,a),this},pluck:function(a){return d.map(this.models,function(b){return b.get(a)})},reset:function(a,b){return a||(a=[]),b||(b={}),this.each(this._removeReference),this._reset(),this.add(a,{silent:!0}),b.silent||this.trigger("reset",this,b),this},fetch:function(a){a||(a={});var b=this,d=a.success;return a.success=function(c,e,f){b[a.add?"add":"reset"](b.parse(c,f),a),d&&d(b,c)},a.error=s(a.error,b,a),(this.sync||c.sync).call(this,"read",this,a)},create:function(a,b){var c=this;b||(b={}),a=this._prepareModel(a,b);if(!a)return!1;var d=b.success;return b.success=function(a,e,f){c.add(a,b),d&&d(a,e,f)},a.save(null,b),a},parse:function(a){return a},chain:function(){return d(this.models).chain()},_reset:function(){this.length=0,this.models=[],this._byId={},this._byCid={}},_prepareModel:function(a,b){if(a instanceof c.Model)a.collection||(a.collection=this);else{var d=a;a=new this.model(d,{collection:this}),a.validate&&!a._performValidation(d,b)&&(a=!1)}return a},_add:function(a,b){b||(b={}),a=this._prepareModel(a,b);if(!a)return!1;var c=this.getByCid(a);if(c)throw Error(["Can't add the same model to a set twice",c.id]);return this._byId[a.id]=a,this._byCid[a.cid]=a,this.models.splice(b.at!=null?b.at:this.comparator?this.sortedIndex(a,this.comparator):this.length,0,a),a.bind("all",this._onModelEvent),this.length++,b.silent||a.trigger("add",a,this,b),a},_remove:function(a,b){return b||(b={}),a=this.getByCid(a)||this.get(a),a?(delete this._byId[a.id],delete this._byCid[a.cid],this.models.splice(this.indexOf(a),1),this.length--,b.silent||a.trigger("remove",a,this,b),this._removeReference(a),a):null},_removeReference:function(a){this==a.collection&&delete a.collection,a.unbind("all",this._onModelEvent)},_onModelEvent:function(a,b,c,d){(a=="add"||a=="remove")&&c!=this||(a=="destroy"&&this._remove(b,d),b&&a==="change:"+b.idAttribute&&(delete this._byId[b.previous(b.idAttribute)],this._byId[b.id]=b),this.trigger.apply(this,arguments))}}),d.each(["forEach","each","map","reduce","reduceRight","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","sortBy","sortedIndex","toArray","size","first","rest","last","without","indexOf","lastIndexOf","isEmpty","groupBy"],function(a){c.Collection.prototype[a]=function(){return d[a].apply(d,[this.models].concat(d.toArray(arguments)))}}),c.Router=function(a){a||(a={}),a.routes&&(this.routes=a.routes),this._bindRoutes(),this.initialize.apply(this,arguments)};var f=/:([\w\d]+)/g,g=/\*([\w\d]+)/g,h=/[-[\]{}()+?.,\\^$|#\s]/g;d.extend(c.Router.prototype,c.Events,{initialize:function(){},route:function(a,b,e){c.history||(c.history=new c.History),d.isRegExp(a)||(a=this._routeToRegExp(a)),c.history.route(a,d.bind(function(c){c=this._extractParameters(a,c),e.apply(this,c),this.trigger.apply(this,["route:"+b].concat(c))},this))},navigate:function(a,b){c.history.navigate(a,b)},_bindRoutes:function(){if(this.routes){var a=[],b;for(b in this.routes)a.unshift([b,this.routes[b]]);b=0;for(var c=a.length;b<c;b++)this.route(a[b][0],a[b][1],this[a[b][1]])}},_routeToRegExp:function(a){return a=a.replace(h,"\\$&").replace(f,"([^/]*)").replace(g,"(.*?)"),RegExp("^"+a+"$")},_extractParameters:function(a,b){return a.exec(b).slice(1)}}),c.History=function(){this.handlers=[],d.bindAll(this,"checkUrl")};var i=/^#*/,j=/msie [\w.]+/,k=!1;d.extend(c.History.prototype,{interval:50,getFragment:function(a,b){if(a==null)if(this._hasPushState||b){a=window.location.pathname;var c=window.location.search;c&&(a+=c),a.indexOf(this.options.root)==0&&(a=a.substr(this.options.root.length))}else a=window.location.hash;return decodeURIComponent(a.replace(i,""))},start:function(a){if(k)throw Error("Backbone.history has already been started");this.options=d.extend({},{root:"/"},this.options,a),this._wantsPushState=!!this.options.pushState,this._hasPushState=!(!this.options.pushState||!window.history||!window.history.pushState),a=this.getFragment();var b=document.documentMode;if(b=j.exec(navigator.userAgent.toLowerCase())&&(!b||b<=7))this.iframe=e('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(a);this._hasPushState?e(window).bind("popstate",this.checkUrl):"onhashchange"in window&&!b?e(window).bind("hashchange",this.checkUrl):setInterval(this.checkUrl,this.interval),this.fragment=a,k=!0,a=window.location,b=a.pathname==this.options.root;if(this._wantsPushState&&!this._hasPushState&&!b)return this.fragment=this.getFragment(null,!0),window.location.replace(this.options.root+"#"+this.fragment),!0;this._wantsPushState&&this._hasPushState&&b&&a.hash&&(this.fragment=a.hash.replace(i,""),window.history.replaceState({},document.title,a.protocol+"//"+a.host+this.options.root+this.fragment));if(!this.options.silent)return this.loadUrl()},route:function(a,b){this.handlers.unshift({route:a,callback:b})},checkUrl:function(){var a=this.getFragment();a==this.fragment&&this.iframe&&(a=this.getFragment(this.iframe.location.hash));if(a==this.fragment||a==decodeURIComponent(this.fragment))return!1;this.iframe&&this.navigate(a),this.loadUrl()||this.loadUrl(window.location.hash)},loadUrl:function(a){var b=this.fragment=this.getFragment(a);return d.any(this.handlers,function(a){if(a.route.test(b))return a.callback(b),!0})},navigate:function(a,b){var c=(a||"").replace(i,"");if(this.fragment!=c&&this.fragment!=decodeURIComponent(c)){if(this._hasPushState){var d=window.location;c.indexOf(this.options.root)!=0&&(c=this.options.root+c),this.fragment=c,window.history.pushState({},document.title,d.protocol+"//"+d.host+c)}else if(window.location.hash=this.fragment=c,this.iframe&&c!=this.getFragment(this.iframe.location.hash))this.iframe.document.open().close(),this.iframe.location.hash=c;b&&this.loadUrl(a)}}}),c.View=function(a){this.cid=d.uniqueId("view"),this._configure(a||{}),this._ensureElement(),this.delegateEvents(),this.initialize.apply(this,arguments)};var l=/^(\S+)\s*(.*)$/,m=["model","collection","el","id","attributes","className","tagName"];d.extend(c.View.prototype,c.Events,{tagName:"div",$:function(a){return e(a,this.el)},initialize:function(){},render:function(){return this},remove:function(){return e(this.el).remove(),this},make:function(a,b,c){return a=document.createElement(a),b&&e(a).attr(b),c&&e(a).html(c),a},delegateEvents:function(a){if(a||(a=this.events))for(var b in d.isFunction(a)&&(a=a.call(this)),e(this.el).unbind(".delegateEvents"+this.cid),a){var c=this[a[b]];if(!c)throw Error('Event "'+a[b]+'" does not exist');var f=b.match(l),g=f[1];f=f[2],c=d.bind(c,this),g+=".delegateEvents"+this.cid,f===""?e(this.el).bind(g,c):e(this.el).delegate(f,g,c)}},_configure:function(a){this.options&&(a=d.extend({},this.options,a));for(var b=0,c=m.length;b<c;b++){var e=m[b];a[e]&&(this[e]=a[e])}this.options=a},_ensureElement:function(){if(this.el)d.isString(this.el)&&(this.el=e(this.el).get(0));else{var a=this.attributes||{};this.id&&(a.id=this.id),this.className&&(a["class"]=this.className),this.el=this.make(this.tagName,a)}}}),c.Model.extend=c.Collection.extend=c.Router.extend=c.View.extend=function(a,b){var c=p(this,a,b);return c.extend=this.extend,c};var n={create:"POST",update:"PUT","delete":"DELETE",read:"GET"};c.sync=function(a,b,f){var g=n[a];return f=d.extend({type:g,dataType:"json"},f),f.url||(f.url=q(b)||r()),!f.data&&b&&(a=="create"||a=="update")&&(f.contentType="application/json",f.data=JSON.stringify(b.toJSON())),c.emulateJSON&&(f.contentType="application/x-www-form-urlencoded",f.data=f.data?{model:f.data}:{}),c.emulateHTTP&&(g==="PUT"||g==="DELETE")&&(c.emulateJSON&&(f.data._method=g),f.type="POST",f.beforeSend=function(a){a.setRequestHeader("X-HTTP-Method-Override",g)}),f.type!=="GET"&&!c.emulateJSON&&(f.processData=!1),e.ajax(f)};var o=function(){},p=function(a,b,c){var e;return e=b&&b.hasOwnProperty("constructor")?b.constructor:function(){return a.apply(this,arguments)},d.extend(e,a),o.prototype=a.prototype,e.prototype=new o,b&&d.extend(e.prototype,b),c&&d.extend(e,c),e.prototype.constructor=e,e.__super__=a.prototype,e},q=function(a){return!a||!a.url?null:d.isFunction(a.url)?a.url():a.url},r=function(){throw Error('A "url" property or function must be specified')},s=function(a,b,c){return function(d){a?a(b,d,c):b.trigger("error",b,d,c)}}}.call(this),function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r;o="scrollbar",n="scroll",g="mousedown",h="mousemove",j="mousewheel",i="mouseup",m="resize",f="drag",p="up",l="panedown",d="DOMMouseScroll",e="down",q="wheel",r=function(){var a,b,d;return b=c.createElement("div"),b.style.position="absolute",b.style.width="100px",b.style.height="100px",b.style.overflow="scroll",c.body.appendChild(b),a=b.offsetWidth,d=b.scrollWidth,c.body.removeChild(b),a-d},k=function(){function k(a){this.el=a,this.generate(),this.createEvents(),this.addEvents(),this.reset()}return k.prototype.createEvents=function(){var b=this;this.events={down:function(d){return b.isDrag=!0,b.offsetY=d.clientY-b.slider.offset().top,b.pane.addClass("active"),a(c).bind(h,b.events[f]),a(c).bind(i,b.events[p]),!1},drag:function(a){return b.sliderY=a.clientY-b.el.offset().top-b.offsetY,b.scroll(),!1},up:function(d){return b.isDrag=!1,b.pane.removeClass("active"),a(c).unbind(h,b.events[f]),a(c).unbind(i,b.events[p]),!1},resize:function(a){b.reset()},panedown:function(a){b.sliderY=a.clientY-b.el.offset().top-b.sliderH*.5,b.scroll(),b.events.down(a)},scroll:function(a){var c,d;c=b.content[0];if(b.isDrag===!0)return;d=c.scrollTop/(c.scrollHeight-c.clientHeight)*(b.paneH-b.sliderH),b.slider.css({top:d+"px"})},wheel:function(a){return b.sliderY+=-a.wheelDeltaY||-a.delta,b.scroll(),!1}}},k.prototype.addEvents=function(){var c,f;c=this.events,f=this.pane,a(b).bind(m,c[m]),this.slider.bind(g,c[e]),f.bind(g,c[l]),this.content.bind(n,c[n]),b.addEventListener&&(f=f[0],f.addEventListener(j,c[q],!1),f.addEventListener(d,c[q],!1))},k.prototype.removeEvents=function(){var c,f;c=this.events,f=this.pane,a(b).unbind(m,c[m]),this.slider.unbind(g,c[e]),f.unbind(g,c[l]),this.content.unbind(n,c[n]),b.addEventListener&&(f=f[0],f.removeEventListener(j,c[q],!1),f.removeEventListener(d,c[q],!1))},k.prototype.generate=function(){this.el.append('<div class="pane"><div class="slider"></div></div>'),this.content=a(this.el.children()[0]),this.slider=this.el.find(".slider"),this.pane=this.el.find(".pane"),this.scrollW=r(),this.scrollbarWidth===0&&(this.scrollW=0),this.content.css({right:-this.scrollW+"px"})},k.prototype.reset=function(){this.isDead===!0&&(this.isDead=!1,this.pane.show(),this.addEvents()),this.contentH=this.content[0].scrollHeight+this.scrollW,this.paneH=this.pane.outerHeight(),this.sliderH=this.paneH/this.contentH*this.paneH,this.sliderH=Math.round(this.sliderH),this.scrollH=this.paneH-this.sliderH,this.slider.height(this.sliderH),this.paneH>=this.content[0].scrollHeight?this.pane.hide():this.pane.show()},k.prototype.scroll=function(){var a;return this.sliderY=Math.max(0,this.sliderY),this.sliderY=Math.min(this.scrollH,this.sliderY),a=this.paneH-this.contentH+this.scrollW,a=a*this.sliderY/this.scrollH,this.content.scrollTop(-a),this.slider.css({top:this.sliderY})},k.prototype.scrollBottom=function(a){this.reset(),this.content.scrollTop(this.contentH-this.content.height()-a)},k.prototype.scrollTop=function(a){this.reset(),this.content.scrollTop(a+0)},k.prototype.stop=function(){this.isDead=!0,this.removeEvents(),this.pane.hide()},k}(),["Left","Top"].forEach(function(b,c){function e(a){return a&&typeof a=="object"&&"setInterval"in a}function f(a){return e(a)?a:a.nodeType===9?a.defaultView||a.parentWindow:!1}var d="scroll"+b;a.fn[d]=function(b){var e,g;if(b===undefined)return e=this[0],e?(g=f(e),g?"pageXOffset"in g?g[c?"pageYOffset":"pageXOffset"]:g.document.documentElement[d]||g.document.body[d]:e[d]):null;this.each(function(){g=f(this);if(g){var e=c?a(g).scrollLeft():b,h=c?b:a(g).scrollTop();g.scrollTo(e,h)}else this[d]=b})}}),["width","height"].forEach(function(b){var c,d=b.replace(/./,function(a){return a[0].toUpperCase()});a.fn["outer"+d]=function(a){var c=this;if(c){var d=c[b](),e={width:["left","right"],height:["top","bottom"]};return e[b].forEach(function(b){a&&(d+=parseInt(c.css("margin-"+b),10))}),d}return null}}),a.fn.nanoScroller=function(b){b||(b={});if(!(a.browser.msie&&parseInt(a.browser.version,10)<8))return this.each(function(){var c;$this=a(this),c=this[o],c||(c=new k($this),this[o]=c);if(b.scrollBottom)return c.scrollBottom(b.scrollBottom);if(b.scrollTop)return c.scrollTop(b.scrollTop);if(b.scroll==="bottom")return c.scrollBottom(0);if(b.scroll==="top")return c.scrollTop(0);if(b.stop)return c.stop();c.reset()})}}(window.jQuery||window.Zepto,window,document);var Handlebars={};Handlebars.VERSION="1.0.beta.5",Handlebars.helpers={},Handlebars.partials={},Handlebars.registerHelper=function(a,b,c){c&&(b.not=c),this.helpers[a]=b},Handlebars.registerPartial=function(a,b){this.partials[a]=b},Handlebars.registerHelper("helperMissing",function(a){if(arguments.length===2)return undefined;throw new Error("Could not find property '"+a+"'")});var toString=Object.prototype.toString,functionType="[object Function]";Handlebars.registerHelper("blockHelperMissing",function(a,b){var c=b.inverse||function(){},d=b.fn,e="",f=toString.call(a);f===functionType&&(a=a.call(this));if(a===!0)return d(this);if(a===!1||a==null)return c(this);if(f==="[object Array]"){if(a.length>0)for(var g=0,h=a.length;g<h;g++)e+=d(a[g]);else e=c(this);return e}return d(a)}),Handlebars.registerHelper("each",function(a,b){var c=b.fn,d=b.inverse,e="";if(a&&a.length>0)for(var f=0,g=a.length;f<g;f++)e+=c(a[f]);else e=d(this);return e}),Handlebars.registerHelper("if",function(a,b){var c=toString.call(a);return c===functionType&&(a=a.call(this)),!a||Handlebars.Utils.isEmpty(a)?b.inverse(this):b.fn(this)}),Handlebars.registerHelper("unless",function(a,b){var c=b.fn,d=b.inverse;return b.fn=d,b.inverse=c,Handlebars.helpers["if"].call(this,a,b)}),Handlebars.registerHelper("with",function(a,b){return b.fn(a)}),Handlebars.registerHelper("log",function(a){Handlebars.log(a)}),Handlebars.Exception=function(a){var b=Error.prototype.constructor.apply(this,arguments);for(var c in b)b.hasOwnProperty(c)&&(this[c]=b[c]);this.message=b.message},Handlebars.Exception.prototype=new Error,Handlebars.SafeString=function(a){this.string=a},Handlebars.SafeString.prototype.toString=function(){return this.string.toString()},function(){var a={"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},b=/&(?!\w+;)|[<>"'`]/g,c=/[&<>"'`]/,d=function(b){return a[b]||"&amp;"};Handlebars.Utils={escapeExpression:function(a){return a instanceof Handlebars.SafeString?a.toString():a==null||a===!1?"":c.test(a)?a.replace(b,d):a},isEmpty:function(a){return typeof a=="undefined"?!0:a===null?!0:a===!1?!0:Object.prototype.toString.call(a)==="[object Array]"&&a.length===0?!0:!1}}}(),Handlebars.VM={template:function(a){var b={escapeExpression:Handlebars.Utils.escapeExpression,invokePartial:Handlebars.VM.invokePartial,programs:[],program:function(a,b,c){var d=this.programs[a];return c?Handlebars.VM.program(b,c):d?d:(d=this.programs[a]=Handlebars.VM.program(b),d)},programWithDepth:Handlebars.VM.programWithDepth,noop:Handlebars.VM.noop};return function(c,d){return d=d||{},a.call(b,Handlebars,c,d.helpers,d.partials,d.data)}},programWithDepth:function(a,b,c){var d=Array.prototype.slice.call(arguments,2);return function(c,e){return e=e||{},a.apply(this,[c,e.data||b].concat(d))}},program:function(a,b){return function(c,d){return d=d||{},a(c,d.data||b)}},noop:function(){return""},invokePartial:function(a,b,c,d,e,f){options={helpers:d,partials:e,data:f};if(a===undefined)throw new Handlebars.Exception("The partial "+b+" could not be found");if(a instanceof Function)return a(c,options);if(!Handlebars.compile)throw new Handlebars.Exception("The partial "+b+" could not be compiled when running in runtime-only mode");return e[b]=Handlebars.compile(a),e[b](c,options)}},Handlebars.template=Handlebars.VM.template,function(a,b,c){function d(a){var b={x:a.offsetLeft,y:a.offsetTop};while(a=a.offsetParent)b.x+=a.offsetLeft,b.y+=a.offsetTop;return b}function e(a,b){for(var d in b)a[d]===c&&(a[d]=b[d]);return a}function f(a,b){for(var c in b)a.style[g(a,c)||c]=b[c];return a}function g(a,b){var d=a.style,e,f;if(d[b]!==c)return b;b=b.charAt(0).toUpperCase()+b.slice(1);for(f=0;f<k.length;f++){e=k[f]+b;if(d[e]!==c)return e}}function h(a,b,c,d){var e=["opacity",b,~~(a*100),c,d].join("-"),f=.01+c/d*100,g=Math.max(1-(1-a)/b*(100-f),a),h=m.substring(0,m.indexOf("Animation")).toLowerCase(),i=h&&"-"+h+"-"||"";return l[e]||(n.insertRule("@"+i+"keyframes "+e+"{"+"0%{opacity:"+g+"}"+f+"%{opacity:"+a+"}"+(f+.01)+"%{opacity:1}"+(f+b)%100+"%{opacity:"+a+"}"+"100%{opacity:"+g+"}"+"}",0),l[e]=1),e}function i(a,b,c){return c&&!c.parentNode&&i(a,c),a.insertBefore(b,c||null),a}function j(a,c){var d=b.createElement(a||"div"),e;for(e in c)d[e]=c[e];return d}var k=["webkit","Moz","ms","O"],l={},m;i(b.getElementsByTagName("head")[0],j("style"));var n=b.styleSheets[b.styleSheets.length-1],o=function q(a){if(!this.spin)return new q(a);this.opts=e(a||{},{lines:12,length:7,width:5,radius:10,color:"#000",speed:1,trail:100,opacity:.25,fps:20})},p=o.prototype={spin:function(a){this.stop();var b=this,c=b.el=f(j(),{position:"relative"}),e,g;a&&(g=d(i(a,c,a.firstChild)),e=d(c),f(c,{left:(a.offsetWidth>>1)-e.x+g.x+"px",top:(a.offsetHeight>>1)-e.y+g.y+"px"})),c.setAttribute("aria-role","progressbar"),b.lines(c,b.opts);if(!m){var h=b.opts,k=0,l=h.fps,n=l/h.speed,o=(1-h.opacity)/(n*h.trail/100),p=n/h.lines;(function q(){k++;for(var a=h.lines;a;a--){var d=Math.max(1-(k+a*p)%n*o,h.opacity);b.opacity(c,h.lines-a,d,h)}b.timeout=b.el&&setTimeout(q,~~(1e3/l))})()}return b},stop:function(){var a=this.el;return a&&(clearTimeout(this.timeout),a.parentNode&&a.parentNode.removeChild(a),this.el=c),this}};p.lines=function(a,b){function c(a,c){return f(j(),{position:"absolute",width:b.length+b.width+"px",height:b.width+"px",background:a,boxShadow:c,transformOrigin:"left",transform:"rotate("+~~(360/b.lines*d)+"deg) translate("+b.radius+"px"+",0)",borderRadius:(b.width>>1)+"px"})}var d=0,e;for(;d<b.lines;d++)e=f(j(),{position:"absolute",top:1+~(b.width/2)+"px",transform:"translate3d(0,0,0)",opacity:b.opacity,animation:m&&h(b.opacity,b.trail,d,b.lines)+" "+1/b.speed+"s linear infinite"}),b.shadow&&i(e,f(c("#000","0 0 4px #000"),{top:"2px"})),i(a,i(e,c(b.color,"0 0 1px rgba(0,0,0,.1)")));return a},p.opacity=function(a,b,c){b<a.childNodes.length&&(a.childNodes[b].style.opacity=c)},function(){var a=f(j("group"),{behavior:"url(#default#VML)"}),b;if(!g(a,"transform")&&a.adj){for(b=4;b--;)n.addRule(["group","roundrect","fill","stroke"][b],"behavior:url(#default#VML)");p.lines=function(a,b){function c(a,c,g){i(h,i(f(d(),{rotation:360/b.lines*a+"deg",left:~~c}),i(f(j("roundrect",{arcsize:1}),{width:e,height:b.width,left:b.radius,top:-b.width>>1,filter:g}),j("fill",{color:b.color,opacity:b.opacity}),j("stroke",{opacity:0}))))}function d(){return f(j("group",{coordsize:g+" "+g,coordorigin:-e+" "+ -e}),{width:g,height:g})}var e=b.length+b.width,g=2*e,h=d(),k=~(b.length+b.radius+b.width)+"px",l;if(b.shadow)for(l=1;l<=b.lines;l++)c(l,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(l=1;l<=b.lines;l++)c(l);return i(f(a,{margin:k+" 0 0 "+k,zoom:1}),h)},p.opacity=function(a,b,c,d){var e=a.firstChild;d=d.shadow&&d.lines||0,e&&b+d<e.childNodes.length&&(e=e.childNodes[b+d],e=e&&e.firstChild,e=e&&e.firstChild,e&&(e.opacity=c))}}else m=g(a,"animation")}(),a.Spinner=o}(window,document),function(a){a.fn.spin=function(b,c){var d={tiny:{lines:8,length:2,width:2,radius:3},small:{lines:8,length:4,width:3,radius:5},large:{lines:10,length:8,width:4,radius:8}};if(Spinner)return this.each(function(){var e=a(this),f=this;f.spinner&&(f.spinner.stop(),delete f.spinner),b!==!1&&(typeof b=="string"&&(b in d?b=d[b]:b={},c&&(b.color=c)),f.spinner=(new Spinner(a.extend({color:e.css("color")},b))).spin(),this.appendChild(f.spinner.el))});throw"Spinner class not available."}}(window.jQuery||window.Zepto||window.ender),function(){var a,b;b=this,a=function(){function a(){_.bindAll(this),this.loadPlugins()}return a.prototype.baseURL="http://chromusapp-v2.appspot.com",a.prototype.audio_players={},a.prototype.audio_sources={},a.prototype.media_types={},a.prototype.plugins={},a.prototype.plugins_info={},a.prototype.plugins_list=["iframe_player","music_manager","ui","echonest","lastfm","loved_tracks_radio","vkontakte","about"],a.prototype.injectPluginFiles=function(){var a,b,c,d,e,f;a=[],f=this.plugins_list;for(d=0,e=f.length;d<e;d++)c=f[d],b=this.plugins_info[c],a.push(_.map(b.files,function(a){var c;return c=a.match(/(.*!)?(.*)/),""+(c[1]||"")+b.path+"/"+c[2]+"?"+ +(new Date)}));return yepnope({load:_.flatten(a),complete:this.pluginsLoadedCallback})},a.prototype.loadPlugins=function(){var a,c,d,e,f,g,h=this;a=_.after(this.plugins_list.length,this.injectPluginFiles),f=this.plugins_list,g=[];for(d=0,e=f.length;d<e;d++)c=f[d],g.push(function(c){var d,e;return e=browser.extension.getURL("/plugins/"+c),d=""+e+"/package.json?"+ +(new Date),b.debug||typeof exports!="undefined"&&exports!==null?$.getJSON(d,function(b){return h.plugins_info[c]=b,h.plugins_info[c].path=e,a()}):(h.plugins_info[c]={},h.plugins_info[c].path=e)}(c));return g},a.prototype.pluginsLoadedCallback=function(){if(typeof b.isTestMode=="function"?b.isTestMode():void 0)return jasmine.getEnv().addReporter(new jasmine.TrivialReporter),jasmine.getEnv().execute()},a.prototype.registerPlugin=function(a,b){return this.plugins[a]=b},a.prototype.registerPlayer=function(a,b){return this.audio_players[a]=b},a.prototype.registerAudioSource=function(a,b){return this.audio_sources[a]=b},a.prototype.registerMediaType=function(a,b){return this.media_types[a]=b},a.prototype.addMenu=function(a){return $("#main_menu").append(a)},a.prototype.openPanel=function(a){var b;return b=$('<div class="panel">').html(a).appendTo($("#wrapper")).delegate(".back","click",function(){return b.removeClass("show"),_.delay(function(){return b.remove()},300)}),_.defer(function(){return b.addClass("show")}),b},a.prototype.closePanel=function(){var a;return a=_.last($(".panel")),$(a).find(".back").trigger("click")},a}(),this.chromus=new a,this.chromus.utils={uid:function(){var a;return(a=this.uid_start)==null&&(this.uid_start=+(new Date)),this.uid_start++}}}.call(this),String.prototype.replaceEntities=function(){return this.replace(/&amp;/g,"&").replace(/%27/g,"'")},String.prototype.stripHTML=function(){var a=document.createElement("DIV");return a.innerHTML=this,a.textContent||a.innerText},Function.prototype.bind=function(a){var b=this;return function(){return b.apply(a,arguments)}},Array.prototype.diff=function(a){return this.filter(function(b){return!(a.indexOf(b)>-1)})},Array.prototype.random=function(){return this[Math.floor(Math.random()*this.length)]},window.getTrackInfo=getTrackInfo,window.findParent=findParent,function(){var a=Handlebars.template,b=Handlebars.templates=Handlebars.templates||{};b["playlist.tmpl"]=a(function(a,b,c,d,e){function o(a,b){var d="",e,f;d+="\r\n    ",e=c.is_previous||a.is_previous,h=i.program(2,p,b),h.hash={},h.fn=h,h.inverse=i.noop,typeof e===j?e=e.call(a,h):e=k.call(a,e,h);if(e||e===0)d+=e;d+='\r\n        <div class="track_container id',e=c.id||a.id,typeof e===j?e=e.call(a,{hash:{}}):e===m&&(e=l.call(a,"id",{hash:{}})),d+=n(e)+'" data-id="',e=c.id||a.id,typeof e===j?e=e.call(a,{hash:{}}):e===m&&(e=l.call(a,"id",{hash:{}})),d+=n(e)+'">\r\n            <div class="artist">\r\n                <div>\r\n                    <div class="image">\r\n                        <img src=\'',e=a,f=c.lfm_img||a.lfm_img,typeof f===j?e=f.call(a,e,{hash:{}}):f===m?e=l.call(a,"lfm_img",e,{hash:{}}):e=f,d+=n(e)+"' />\r\n                    </div>\r\n                        \r\n                    <span title=\"",e=c.artist||a.artist,typeof e===j?e=e.call(a,{hash:{}}):e===m&&(e=l.call(a,"artist",{hash:{}})),d+=n(e)+'">',e=c.artist||a.artist,typeof e===j?e=e.call(a,{hash:{}}):e===m&&(e=l.call(a,"artist",{hash:{}})),d+=n(e)+'</span>\r\n                </div>\r\n            </div>\r\n            <div class="song ',e=c.is_current||a.is_current,h=i.program(5,r,b),h.hash={},h.fn=h,h.inverse=i.noop,typeof e===j?e=e.call(a,h):e=k.call(a,e,h);if(e||e===0)d+=e;d+="\" data-id='",e=c.id||a.id,typeof e===j?e=e.call(a,{hash:{}}):e===m&&(e=l.call(a,"id",{hash:{}})),d+=n(e)+'\'>                        \r\n                <span class="title">',e=c.title||a.title,typeof e===j?e=e.call(a,{hash:{}}):e===m&&(e=l.call(a,"title",{hash:{}}));if(e||e===0)d+=e;d+='</span>\r\n                <div class="controls">\r\n                    <a class="button play"></a>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    ',e=c.is_next||a.is_next,h=i.program(7,s,b),h.hash={},h.fn=h,h.inverse=i.noop,typeof e===j?e=e.call(a,h):e=k.call(a,e,h);if(e||e===0)d+=e;return d+="\r\n",d}function p(a,b){var d="",e;d+='\r\n    <div class="artist_playlist ',e=c.more_then_two||a.more_then_two,h=i.program(3,q,b),h.hash={},h.fn=h,h.inverse=i.noop,typeof e===j?e=e.call(a,h):e=k.call(a,e,h);if(e||e===0)d+=e;return d+='">\r\n    ',d}function q(a,b){return"large"}function r(a,b){return"playing"}function s(a,b){return"\r\n    </div>\r\n    "}c=c||a.helpers;var f,g,h,i=this,j="function",k=c.blockHelperMissing,l=c.helperMissing,m=void 0,n=this.escapeExpression;return f=c.playlist||b.playlist,g=c.each,h=i.program(1,o,e),h.hash={},h.fn=h,h.inverse=i.noop,f=g.call(b,f,h),f||f===0?f:""})}(),function(){var a=Handlebars.template,b=Handlebars.templates=Handlebars.templates||{};b["track_info.tmpl"]=a(function(a,b,c,d,e){function o(a,b){var d="",e;return d+='\r\n        <span class="dash">-</span>\r\n        <a class="album" href="',e=c.album_url||a.album_url,typeof e===k?e=e.call(a,{hash:{}}):e===m&&(e=l.call(a,"album_url",{hash:{}})),d+=n(e)+'" target="_blank">',e=c.album||a.album,typeof e===k?e=e.call(a,{hash:{}}):e===m&&(e=l.call(a,"album",{hash:{}})),d+=n(e)+"</a>\r\n        ",d}function p(a,b){var d="",e;return d+='\r\n    <a>\r\n        <img src="',e=c.source_icon||a.source_icon,typeof e===k?e=e.call(a,{hash:{}}):e===m&&(e=l.call(a,"source_icon",{hash:{}})),d+=n(e)+'" />\r\n        <span>',e=c.source_title||a.source_title,typeof e===k?e=e.call(a,{hash:{}}):e===m&&(e=l.call(a,"source_title",{hash:{}})),d+=n(e)+"</span>\r\n    </a>\r\n    ",d}c=c||a.helpers;var f="",g,h,i,j=this,k="function",l=c.helperMissing,m=void 0,n=this.escapeExpression;f+='<div class="container">\r\n    <a class="album_img">\r\n        <img src="',g=b,h=c.lfm_img||b.lfm_img,typeof h===k?g=h.call(b,g,{hash:{}}):h===m?g=l.call(b,"lfm_img",g,{hash:{}}):g=h,f+=n(g)+'" />\r\n    </a>\r\n    <div class="love_btn"><a class=\'button\'></a></div>\r\n    <div class="info">\r\n        <a class="song" href="',g=c.song_url||b.song_url,typeof g===k?g=g.call(b,{hash:{}}):g===m&&(g=l.call(b,"song_url",{hash:{}})),f+=n(g)+'" target="_blank">',g=c.song||b.song,typeof g===k?g=g.call(b,{hash:{}}):g===m&&(g=l.call(b,"song",{hash:{}})),f+=n(g)+'</a>\r\n        <a class="artist" href="',g=c.artist_url||b.artist_url,typeof g===k?g=g.call(b,{hash:{}}):g===m&&(g=l.call(b,"artist_url",{hash:{}})),f+=n(g)+'" target="_blank">',g=c.artist||b.artist,typeof g===k?g=g.call(b,{hash:{}}):g===m&&(g=l.call(b,"artist",{hash:{}})),f+=n(g)+"</a>\r\n        ",g=c.album||b.album,h=c["if"],i=j.program(1,o,e),i.hash={},i.fn=i,i.inverse=j.noop,g=h.call(b,g,i);if(g||g===0)f+=g;f+='\r\n    </div>\r\n</div>\r\n\r\n<div class="source">\r\n    ',g=c.source_title||b.source_title,h=c["if"],i=j.program(3,p,e),i.hash={},i.fn=i,i.inverse=j.noop,g=h.call(b,g,i);if(g||g===0)f+=g;return f+='\r\n</div>\r\n<div class="loader"></div>',f})}(),function(){var a=Handlebars.template,b=Handlebars.templates=Handlebars.templates||{};b["search_results.tmpl"]=a(function(a,b,c,d,e){function p(a,b){var d="",e;return d+="\r\n    <h3>Search &laquo;",e=c.search_term||a.search_term,typeof e===k?e=e.call(a,{hash:{}}):e===m&&(e=l.call(a,"search_term",{hash:{}})),d+=n(e)+"&raquo;</h3>\r\n    ",d}function q(a,b){var d="",e;d+="\r\n<h3>Artists</h3>\r\n<ul>\r\n    ",e=c.artists||a.artists,i=j.program(4,r,b),i.hash={},i.fn=i,i.inverse=j.noop,typeof e===k?e=e.call(a,i):e=o.call(a,e,i);if(e||e===0)d+=e;d+="\r\n    ",e=c.artists||a.artists,i=j.noop,i.hash={},i.fn=i,i.inverse=j.program(6,s,b),typeof e===k?e=e.call(a,i):e=o.call(a,e,i);if(e||e===0)d+=e;return d+="\r\n</ul>\r\n",d}function r(a,b){var d="",e,f;return d+='\r\n        <li>\r\n            <a class="ex_container" data-artist="',e=c.name||a.name,typeof e===k?e=e.call(a,{hash:{}}):e===m&&(e=l.call(a,"name",{hash:{}})),d+=n(e)+'">\r\n                <span class="image" style=\'background-image: url(',e=a,f=c.lfm_img||a.lfm_img,typeof f===k?e=f.call(a,e,{hash:{}}):f===m?e=l.call(a,"lfm_img",e,{hash:{}}):e=f,d+=n(e)+")'></span>\r\n                <span>",e=c.name||a.name,typeof e===k?e=e.call(a,{hash:{}}):e===m&&(e=l.call(a,"name",{hash:{}})),d+=n(e)+'</span>\r\n\r\n                <span class="add_to_playlist" title="Add to playlist"></span>\r\n            </a>\r\n        </li>\r\n    ',d}function s(a,b){return'\r\n        <li class="loader"></li>\r\n    '}function t(a,b){var d="",e;d+="\r\n<h3>Tracks</h3>\r\n<ul>\r\n    ",e=c.tracks||a.tracks,i=j.program(9,u,b),i.hash={},i.fn=i,i.inverse=j.noop,typeof e===k?e=e.call(a,i):e=o.call(a,e,i);if(e||e===0)d+=e;d+="\r\n    ",e=c.tracks||a.tracks,i=j.noop,i.hash={},i.fn=i,i.inverse=j.program(11,v,b),typeof e===k?e=e.call(a,i):e=o.call(a,e,i);if(e||e===0)d+=e;return d+="\r\n</ul>\r\n",d}function u(a,b){var d="",e,f;return d+='\r\n        <li>\r\n            <a class="ex_container" data-artist="',e=c.artist||a.artist,typeof e===k?e=e.call(a,{hash:{}}):e===m&&(e=l.call(a,"artist",{hash:{}})),d+=n(e)+'" data-song="',e=c.name||a.name,typeof e===k?e=e.call(a,{hash:{}}):e===m&&(e=l.call(a,"name",{hash:{}})),d+=n(e)+'">\r\n                <span class="image" style=\'background-image: url(',e=a,f=c.lfm_img||a.lfm_img,typeof f===k?e=f.call(a,e,{hash:{}}):f===m?e=l.call(a,"lfm_img",e,{hash:{}}):e=f,d+=n(e)+")'></span>\r\n                <span>",e=c.artist||a.artist,typeof e===k?e=e.call(a,{hash:{}}):e===m&&(e=l.call(a,"artist",{hash:{}})),d+=n(e)+"<br/><b>",e=c.name||a.name,typeof e===k?e=e.call(a,{hash:{}}):e===m&&(e=l.call(a,"name",{hash:{}})),d+=n(e)+'</b></span>\r\n\r\n                <span class="add_to_playlist" title="Add to playlist"></span>\r\n            </a>\r\n        </li>\r\n    ',d}function v(a,b){return'\r\n        <li class="loader"></li>\r\n    '}function w(a,b){var d="",e;d+="\r\n<h3>Albums</h3>\r\n<ul>\r\n    ",e=c.albums||a.albums,i=j.program(14,x,b),i.hash={},i.fn=i,i.inverse=j.noop,typeof e===k?e=e.call(a,i):e=o.call(a,e,i);if(e||e===0)d+=e;d+="\r\n    ",e=c.albums||a.albums,i=j.noop,i.hash={},i.fn=i,i.inverse=j.program(16,y,b),typeof e===k?e=e.call(a,i):e=o.call(a,e,i);if(e||e===0)d+=e;return d+="\r\n</ul>\r\n",d}function x(a,b){var d="",e,f;return d+='\r\n        <li>\r\n            <a class="ex_container" data-artist="',e=c.artist||a.artist,typeof e===k?e=e.call(a,{hash:{}}):e===m&&(e=l.call(a,"artist",{hash:{}})),d+=n(e)+'" data-album="',e=c.name||a.name,typeof e===k?e=e.call(a,{hash:{}}):e===m&&(e=l.call(a,"name",{hash:{}})),d+=n(e)+'">\r\n                <span class="image" style=\'background-image: url(',e=a,f=c.lfm_img||a.lfm_img,typeof f===k?e=f.call(a,e,{hash:{}}):f===m?e=l.call(a,"lfm_img",e,{hash:{}}):e=f,d+=n(e)+")'></span>\r\n                <span>",e=c.artist||a.artist,typeof e===k?e=e.call(a,{hash:{}}):e===m&&(e=l.call(a,"artist",{hash:{}})),d+=n(e)+"<br/><b>",e=c.name||a.name,typeof e===k?e=e.call(a,{hash:{}}):e===m&&(e=l.call(a,"name",{hash:{}})),d+=n(e)+'</b></span>\r\n\r\n                <span class="add_to_playlist" title="Add to playlist"></span>\r\n            </a>\r\n        </li>\r\n    ',d}function y(a,b){return'\r\n        <li class="loader"></li>\r\n    '}c=c||a.helpers;var f="",g,h,i,j=this,k="function",l=c.helperMissing,m=void 0,n=this.escapeExpression,o=c.blockHelperMissing;f+='<header>\r\n    <a class="back"></a>\r\n    ',g=c.search_term||b.search_term,h=c["if"],i=j.program(1,p,e),i.hash={},i.fn=i,i.inverse=j.noop,g=h.call(b,g,i);if(g||g===0)f+=g;f+='\r\n</header>\r\n\r\n<div class="search_results">\r\n',g=c.show_artists||b.show_artists,i=j.program(3,q,e),i.hash={},i.fn=i,i.inverse=j.noop,typeof g===k?g=g.call(b,i):g=o.call(b,g,i);if(g||g===0)f+=g;f+="\r\n\r\n",g=c.show_tracks||b.show_tracks,i=j.program(8,t,e),i.hash={},i.fn=i,i.inverse=j.noop,typeof g===k?g=g.call(b,i):g=o.call(b,g,i);if(g||g===0)f+=g;f+="\r\n\r\n",g=c.show_albums||b.show_albums,i=j.program(13,w,e),i.hash={},i.fn=i,i.inverse=j.noop,typeof g===k?g=g.call(b,i):g=o.call(b,g,i);if(g||g===0)f+=g;return f+="\r\n</div>",f})}(),function(){var a,b,c,d,e,f,g,h,i,j=Object.prototype.hasOwnProperty,k=function(a,b){function d(){this.constructor=a}for(var c in b)j.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};Handlebars.registerHelper("lfm_img",function(a){var b,c;(c=a.images)==null&&(a.images=a.image);if(!a.images)return"about:blank";b=a.images[0];if(typeof a.images[0]=="string")return a.images[0];try{return a.images[1]["#text"]}catch(d){}}),g=function(){function a(){a.__super__.constructor.apply(this,arguments)}return k(a,Backbone.Model),a}(),e=function(){function a(){a.__super__.constructor.apply(this,arguments)}return k(a,Backbone.Collection),a.prototype.model=g,a}(),d=function(){function a(){a.__super__.constructor.apply(this,arguments)}return k(a,Backbone.Model),a.prototype.initialize=function(){return _.bindAll(this,"listener"),this.playlist=new e,this.state=new Backbone.Model,this.settings=new Backbone.Model({repeat:!1,shuffle:!1}),browser.addMessageListener(this.listener)},a.prototype.currentTrack=function(){return this.playlist.get(this.get("current_track"))},a.prototype.play=function(a){var b;return a==null&&(a=this.get("current_track")),b=this.playlist.get(a),b.get("action")?b.set({song:"Loading..."}):(this.set({current_track:a}),this.state.set({name:"playing"})),browser.postMessage({method:"play",track:parseInt(a)})},a.prototype.pause=function(){return this.state.set({name:"paused"}),browser.postMessage({method:"pause"})},a.prototype.next=function(){return browser.postMessage({method:"nextTrack"})},a.prototype.setPosition=function(a){return this.state.set({played:a}),browser.postMessage({method:"setPosition",position:a})},a.prototype.setVolume=function(a){return this.set({volume:a}),browser.postMessage({method:"setVolume",volume:a})},a.prototype.setSettings=function(a){return this.settings.set(a),browser.postMessage({method:"setSettings",data:a})},a.prototype.listener=function(a){var b;if(a.method.match("^sm2"))return;a.method.match("(playerState|updateState)")?a.track&&((b=a.state.name)==="playing"||b==="loading")&&(this.playlist.get(a.track.id).set(a.track),this.set({current_track:a.track.id})):console.log("Popup received message",a.method,a),a.settings!=null&&this.settings.set(a.settings),this.set({volume:a.volume!=null?a.volume:void 0}),a.state!=null&&this.state.set(a.state);if(a.playlist)return this.playlist.reset(a.playlist)},a}(),b=function(){function a(){a.__super__.constructor.apply(this,arguments)}return k(a,Backbone.View),a.prototype.el=$("#header"),a.prototype.search_template=Handlebars.templates["search_results.tmpl"],a.prototype.events={"click .inner":"setPosition","click .progress":"setPosition","click .toggle":"togglePlaying","click .next":"nextTrack","click .search":"toggleSearch","keyup .search_bar .text":"search"},a.prototype.initialize=function(){var a,b=this;return _.bindAll(this),this.model.state.bind("change",this.updateState),a={lines:8,length:2,width:2,radius:3,color:"#fff"},this.spinner=new Spinner(a),this.updateState(this.model.state),$(".panel.search span.add_to_playlist").live("click",function(a){return b.addToPlaylist(a)}),$(".panel.search a.ex_container").live("click",function(a){return b.playSearchedTrack(a)})},a.prototype.updateState=function(a){var b,c,d;c=this.model.currentTrack(),a=a.toJSON(),b=this.$(".toggle").removeClass("play pause"),this.spinner.stop();switch(a.name){case"playing":case"stopped":b.addClass("play");break;case"paused":b.addClass("pause");break;case"loading":this.spinner.spin(b[0]);break;default:b.addClass("play")}return(c!=null?c.get("duration"):void 0)?(this.$(".inner").width(a.played/c.get("duration")*100+"%"),this.$(".time").html("-"+prettyTime(c.get("duration")-a.played)),(d=a.buffered)==null&&(a.buffered=0),this.$(".progress").width(a.buffered/c.get("duration")*100+"%")):this.$(".time").html(prettyTime(0))},a.prototype.setPosition=function(a){var b,c;return c=this.model.currentTrack(),b=a.offsetX/278*c.get("duration"),this.model.setPosition(b)},a.prototype.togglePlaying=function(){return this.model.state.get("name")==="paused"?this.model.play():this.model.pause()},a.prototype.nextTrack=function(){return this.model.next()},a.prototype.toggleSearch=function(){var a,b=this;return $("#first_run .search-tip").hide(),this.el.toggleClass("search_mode"),this.el.hasClass("search_mode")?(this.$(".search_bar").addClass("show"),setTimeout(function(){return b.$(".search_bar").find("input").focus()},500),this.search_panel=chromus.openPanel(this.search_template((a=this.search_view)!=null?a:{})).addClass("search")):(this.$(".search_bar").removeClass("show"),chromus.closePanel())},a.prototype.search=_.debounce(function(a){var b,c,d,e=this;if((d=a.keyCode)===40||d===45||d===37||d===39||d===38)return;return c=a.currentTarget.value,c.trim()?($("#first_run .search-tip").hide(),this.search_view={search_term:c,show_tracks:function(a){var b;if(!this.tracks||((b=this.tracks)!=null?b.length:void 0))return a(this)},show_albums:function(a){var b;if(!this.albums||((b=this.albums)!=null?b.length:void 0))return a(this)},show_artists:function(a){var b;if(!this.artists||((b=this.artists)!=null?b.length:void 0))return a(this)}},b=function(){var a;return e.search_panel.html(e.search_template((a=e.search_view)!=null?a:{})).find(".loader").spin("small")},b(),chromus.plugins.lastfm.artist.search(c,function(a){return a==null&&(a=[]),e.search_view.artists=_.first(a,4),b()}),chromus.plugins.lastfm.track.search(c,function(a){return a==null&&(a=[]),e.search_view.tracks=_.first(a,4),b()}),chromus.plugins.lastfm.album.search(c,function(a){return a==null&&(a=[]),e.search_view.albums=_.first(a,4),b()})):this.$(".search_bar .result").html("")},500),a.prototype.playSearchedTrack=function(a){var b;return b=getTrackInfo(a.currentTarget),browser.postMessage({method:"play",track:b,playlist:[b]}),this.toggleSearch()},a.prototype.addToPlaylist=function(a){var b;return b=getTrackInfo(a.currentTarget.parentNode),browser.postMessage({method:"addToPlaylist",tracks:[b]}),this.toggleSearch(),a.stopPropagation()},a}(),h=function(){function a(){a.__super__.constructor.apply(this,arguments)}return k(a,Backbone.View),a.prototype.el=$("#current_song"),a.prototype.events={"click .album_img":"albumCover"},a.prototype.template=Handlebars.templates["track_info.tmpl"],a.prototype.initialize=function(){return _.bindAll(this,"updateInfo"),this.model.bind("change:current_track",this.updateInfo),this.model.playlist.bind("all",_.debounce(this.updateInfo,500))},a.prototype.updateInfo=function(){var a,b,c,d;return b=(c=this.model.currentTrack())!=null?c.toJSON():void 0,b?((d=b.images)==null&&(b.images=[chromus.plugins.lastfm.image({artist:b.artist})]),a="http://last.fm/music",b.artist_url=""+a+"/"+b.artist,b.album_url=""+a+"/"+b.artist+"/"+b.album,b.song_url=""+a+"/"+b.artist+"/_/"+b.song,this.el.html(this.template(b)).show()):this.el.empty()},a.prototype.albumCover=function(){var a,b,c;return!1},a}(),c=function(){function a(){a.__super__.constructor.apply(this,arguments)}return k(a,Backbone.View),a.prototype.el=$("#footer"),a.prototype.events={"click .menu":"toggleMenu","click .volume":"toggleVolume","click .volume_bar .bar_bg":"setVolume","click .shuffle":"toggleShuffle","click .repeat":"toggleRepeat"},a.prototype.initialize=function(){return _.bindAll(this),this.model.bind("change:volume",this.updateVolume),this.model.settings.bind("change",this.updateSettings),this.updateVolume(),$(document).bind("click",function(a){if($("#main_menu").css("display")!=="none"&&!$(a.target).hasClass("menu")&&!$(a.target).closest("#main_menu").length)return $("#main_menu").hide()})},a.prototype.toggleMenu=function(){return $("#first_run .settings-tip").hide(),$("#main_menu").toggle()},a.prototype.toggleVolume=function(){return this.model.setVolume(0)},a.prototype.setVolume=function(a){var b,c;return b=this.$(".volume_bar .bar_bg").width(),c=a.layerX/b*100,this.model.setVolume(c)},a.prototype.updateVolume=function(){return this.$(".volume_bar .bar").css({width:this.model.get("volume")+"%"})},a.prototype.toggleShuffle=function(){return this.model.setSettings({shuffle:!this.$(".shuffle").hasClass("active")})},a.prototype.toggleRepeat=function(){return this.model.setSettings({repeat:!this.$(".repeat").hasClass("active")})},a.prototype.updateSettings=function(){return this.$(".shuffle").toggleClass("active",this.model.settings.get("shuffle")),this.$(".repeat").toggleClass("active",this.model.settings.get("repeat"))},a}(),f=function(){function a(){a.__super__.constructor.apply(this,arguments)}return k(a,Backbone.View),a.prototype.el=$("#playlist"),a.prototype.template=Handlebars.templates["playlist.tmpl"],a.prototype.events={"click #playlist .song":"togglePlaying"},a.prototype.initialize=function(){var a,b,c,d,e;_.bindAll(this,"updatePlaylist","updateCurrent"),b=_.debounce(this.updatePlaylist,200),e=["change:song","change:artist","add","remove","reset"];for(c=0,d=e.length;c<d;c++)a=e[c],this.model.playlist.bind(a,b);return this.model.bind("change:current_track",this.updateCurrent),this.el.find(".nano").nanoScroller()},a.prototype.togglePlaying=function(a){var b;return b=+$(a.currentTarget).attr("data-id"),this.model.get("current_track")===b?this.model.pause():this.model.play(b)},a.prototype.artistPlaylistCount=function(a,b){var c,d,e,f,g;c=0,g=this.model.playlist.models.slice(b,b+3+1||9e9);for(e=0,f=g.length;e<f;e++)d=g[e],d.get("artist")===a&&c++;return c},a.prototype.updateCurrent=function(){var a;this.$(".song.playing").removeClass("playing"),a=this.model.get("current_track");if(a)return this.$(".track_container.id"+a+" .song").addClass("playing")},a.prototype.updatePlaylist=function(){var a,b,c,d,e,f,g,h,i;b=0,d=this.model.playlist.toJSON();for(g=0,h=d.length;g<h;g++){e=d[g],(i=e.images)==null&&(e.images=[chromus.plugins.lastfm.image({artist:e.artist})]),e.previous=d[g-1],e.next=d[g+1];if(!e.previous||e.previous.artist!==e.artist)e.artist_playlist_count=this.artistPlaylistCount(e.artist,g)}return f={playlist:d},c=this.model,a={is_previous:function(a){if(!this.previous||this.previous.artist!==this.artist)return a(this)},is_next:function(a){if(!this.next||this.next.artist!==this.artist)return a(this)},title:function(a){return this.type==="artist"?"Loading...":this.song||this.name},more_then_two:function(a){if(this.artist_playlist_count>2)return a(this)},is_current:function(a){if(this.id===c.get("current_track"))return a(this)}},a=_.defaults(a,Handlebars.helpers),this.el.find(".container").html(this.template(f,{helpers:a})),this.el.css({visibility:"visible"}),this.el.find(".track_container").each(function(a,b){if(a%2===0)return $(b).addClass("odd")}),this.el.find(".nano").nanoScroller()},a}(),a=function(){function a(){a.__super__.constructor.apply(this,arguments)}return k(a,Backbone.View),a.prototype.initialize=function(){return this.model=new d,this.playlist=new f({model:this.model}),this.controls=new b({model:this.model}),this.track_info=new h({model:this.model}),this.footer=new c({model:this.model}),$("#dialog").bind("click",function(a){if(a.target.id==="dialog")return $("#dialog").hide()}),browser.isPokki&&$("#minimize").bind("click",function(){return pokki.closePopup()}),store.get("first_run")||($("#first_run").show(),$("#first_run > div").bind("click",function(a){return $(a.currentTarget).remove()}),store.set("first_run",!0)),$(".panel .back").live("click",function(a){return $("#header").removeClass("search_mode").find(".search_bar").removeClass("show")})},a.prototype.start=function(){return browser.postMessage({method:"ui:init"})},a}(),this.app=new a,$(function(){return browser.onReady(function(){return app.start()})}),i=$("<li>Clear playlist</li>").bind("click",function(){return $("#main_menu").hide(),browser.postMessage({method:"clearPlaylist"})}),chromus.addMenu(i)}.call(this),function(){var a,b;a={settings:{baseURL:"http://developer.echonest.com/api/v4",format:"jsonp",api_key:"D3QELXPGA1KC6AJ6U"},callMethod:function(a,b,c){return b==null&&(b={}),b.format=this.settings.format,b.api_key=this.settings.api_key,$.ajax({url:""+this.settings.baseURL+"/"+a,data:b,cache:!0,dataType:this.settings.format,success:function(a){return console.log("Echo response:",a),c(a.response)}})},song:{search:function(b,c){return a.callMethod("song/search",{combined:b,sort:"artist_familiarity-desc"},function(a){return c(a.songs)})}},artist:{suggest:function(b,c){return a.callMethod("artist/suggest",{name:b},function(a){return c(a.artists)})}}},(b=this.chromus)!=null&&b.registerPlugin("echo",a)}.call(this),function(e){function g(a){str="";for(j=0;j<=3;j++)str+=f.charAt(a>>j*8+4&15)+f.charAt(a>>j*8&15);return str}function h(a){nblk=(a.length+8>>6)+1,blks=new Array(nblk*16);for(i=0;i<nblk*16;i++)blks[i]=0;for(i=0;i<a.length;i++)blks[i>>2]|=a.charCodeAt(i)<<i%4*8;return blks[i>>2]|=128<<i%4*8,blks[nblk*16-2]=a.length*8,blks}function k(a,b){var c=(a&65535)+(b&65535),d=(a>>16)+(b>>16)+(c>>16);return d<<16|c&65535}function l(a,b){return a<<b|a>>>32-b}function m(a,b,c,d,e,f){return k(l(k(k(b,a),k(d,f)),e),c)}function n(a,b,c,d,e,f,g){return m(b&c|~b&d,a,b,e,f,g)}function o(a,b,c,d,e,f,g){return m(b&d|c&~d,a,b,e,f,g)}function p(a,b,c,d,e,f,g){return m(b^c^d,a,b,e,f,g)}function q(a,b,c,d,e,f,g){return m(c^(b|~d),a,b,e,f,g)}function r(e){x=h(e),a=1732584193,b=-271733879,c=-1732584194,d=271733878;for(i=0;i<x.length;i+=16)olda=a,oldb=b,oldc=c,oldd=d,a=n(a,b,c,d,x[i+0],7,-680876936),d=n(d,a,b,c,x[i+1],12,-389564586),c=n(c,d,a,b,x[i+2],17,606105819),b=n(b,c,d,a,x[i+3],22,-1044525330),a=n(a,b,c,d,x[i+4],7,-176418897),d=n(d,a,b,c,x[i+5],12,1200080426),c=n(c,d,a,b,x[i+6],17,-1473231341),b=n(b,c,d,a,x[i+7],22,-45705983),a=n(a,b,c,d,x[i+8],7,1770035416),d=n(d,a,b,c,x[i+9],12,-1958414417),c=n(c,d,a,b,x[i+10],17,-42063),b=n(b,c,d,a,x[i+11],22,-1990404162),a=n(a,b,c,d,x[i+12],7,1804603682),d=n(d,a,b,c,x[i+13],12,-40341101),c=n(c,d,a,b,x[i+14],17,-1502002290),b=n(b,c,d,a,x[i+15],22,1236535329),a=o(a,b,c,d,x[i+1],5,-165796510),d=o(d,a,b,c,x[i+6],9,-1069501632),c=o(c,d,a,b,x[i+11],14,643717713),b=o(b,c,d,a,x[i+0],20,-373897302),a=o(a,b,c,d,x[i+5],5,-701558691),d=o(d,a,b,c,x[i+10],9,38016083),c=o(c,d,a,b,x[i+15],14,-660478335),b=o(b,c,d,a,x[i+4],20,-405537848),a=o(a,b,c,d,x[i+9],5,568446438),d=o(d,a,b,c,x[i+14],9,-1019803690),c=o(c,d,a,b,x[i+3],14,-187363961),b=o(b,c,d,a,x[i+8],20,1163531501),a=o(a,b,c,d,x[i+13],5,-1444681467),d=o(d,a,b,c,x[i+2],9,-51403784),c=o(c,d,a,b,x[i+7],14,1735328473),b=o(b,c,d,a,x[i+12],20,-1926607734),a=p(a,b,c,d,x[i+5],4,-378558),d=p(d,a,b,c,x[i+8],11,-2022574463),c=p(c,d,a,b,x[i+11],16,1839030562),b=p(b,c,d,a,x[i+14],23,-35309556),a=p(a,b,c,d,x[i+1],4,-1530992060),d=p(d,a,b,c,x[i+4],11,1272893353),c=p(c,d,a,b,x[i+7],16,-155497632),b=p(b,c,d,a,x[i+10],23,-1094730640),a=p(a,b,c,d,x[i+13],4,681279174),d=p(d,a,b,c,x[i+0],11,-358537222),c=p(c,d,a,b,x[i+3],16,-722521979),b=p(b,c,d,a,x[i+6],23,76029189),a=p(a,b,c,d,x[i+9],4,-640364487),d=p(d,a,b,c,x[i+12],11,-421815835),c=p(c,d,a,b,x[i+15],16,530742520),b=p(b,c,d,a,x[i+2],23,-995338651),a=q(a,b,c,d,x[i+0],6,-198630844),d=q(d,a,b,c,x[i+7],10,1126891415),c=q(c,d,a,b,x[i+14],15,-1416354905),b=q(b,c,d,a,x[i+5],21,-57434055),a=q(a,b,c,d,x[i+12],6,1700485571),d=q(d,a,b,c,x[i+3],10,-1894986606),c=q(c,d,a,b,x[i+10],15,-1051523),b=q(b,c,d,a,x[i+1],21,-2054922799),a=q(a,b,c,d,x[i+8],6,1873313359),d=q(d,a,b,c,x[i+15],10,-30611744),c=q(c,d,a,b,x[i+6],15,-1560198380),b=q(b,c,d,a,x[i+13],21,1309151649),a=q(a,b,c,d,x[i+4],6,-145523070),d=q(d,a,b,c,x[i+11],10,-1120210379),c=q(c,d,a,b,x[i+2],15,718787259),b=q(b,c,d,a,x[i+9],21,-343485551),a=k(a,olda),b=k(b,oldb),c=k(c,oldc),d=k(d,oldd);return g(a)+g(b)+g(c)+g(d)}var f="0123456789abcdef";e.MD5=r}(this),function(){var a=Handlebars.template,b=Handlebars.templates=Handlebars.templates||{};b["lastfm.ui.tmpl"]=a(function(a,b,c,d,e){function o(a,b){var d="",e,f;d+='\r\n    <form class="form">\r\n        <div class="logo"></div>\r\n        <ul>          \r\n            <li class="username">\r\n                <label>Logged as <a href="http://last.fm/user/',e=c.user||a.user,typeof e===k?e=e.call(a,{hash:{}}):e===m&&(e=l.call(a,"user",{hash:{}})),d+=n(e)+'" target="_blank">',e=c.user||a.user,typeof e===k?e=e.call(a,{hash:{}}):e===m&&(e=l.call(a,"user",{hash:{}})),d+=n(e)+'</a></label>\r\n            </li>\r\n            <li class="toggle">\r\n                <label>Scrobbling</label>\r\n                <div class="toggler ',e=c.scrobbling||a.scrobbling,f=c.unless,i=j.program(2,p,b),i.hash={},i.fn=i,i.inverse=j.noop,e=f.call(a,e,i);if(e||e===0)d+=e;d+='">\r\n                    <div></div>\r\n                </div>                    \r\n            </li>\r\n            <li class="clearfix"></li>\r\n            \r\n            <li class="header">\r\n                <span>Your Stations</span>\r\n                ',e=c.subscriber||a.subscriber,f=c.unless,i=j.program(4,q,b),i.hash={},i.fn=i,i.inverse=j.noop,e=f.call(a,e,i);if(e||e===0)d+=e;d+='\r\n            </li>\r\n\r\n            <li class="stations ',e=c.subscriber||a.subscriber,f=c.unless,i=j.program(6,r,b),i.hash={},i.fn=i,i.inverse=j.noop,e=f.call(a,e,i);if(e||e===0)d+=e;return d+='">\r\n                <ul>                    \r\n                    <li class="loved_radio free">Loved Tracks</li>\r\n\r\n                    <li class="lastfm_radio pay" data-radio="lastfm://user/',e=c.user||a.user,typeof e===k?e=e.call(a,{hash:{}}):e===m&&(e=l.call(a,"user",{hash:{}})),d+=n(e)+'/personal">Library Radio</li>\r\n                    <li class="lastfm_radio pay" data-radio="lastfm://user/',e=c.user||a.user,typeof e===k?e=e.call(a,{hash:{}}):e===m&&(e=l.call(a,"user",{hash:{}})),d+=n(e)+'/mix">Mix Radio</li>\r\n                    <li class="lastfm_radio pay" data-radio="lastfm://user/',e=c.user||a.user,typeof e===k?e=e.call(a,{hash:{}}):e===m&&(e=l.call(a,"user",{hash:{}})),d+=n(e)+'/recommended">Recommended Radio</li>\r\n                    <li class="lastfm_radio pay" data-radio="lastfm://user/',e=c.user||a.user,typeof e===k?e=e.call(a,{hash:{}}):e===m&&(e=l.call(a,"user",{hash:{}})),d+=n(e)+'/friends">Friends Radio</li>\r\n                    <li class="lastfm_radio pay" data-radio="lastfm://user/',e=c.user||a.user,typeof e===k?e=e.call(a,{hash:{}}):e===m&&(e=l.call(a,"user",{hash:{}})),d+=n(e)+'/neighbours">Neighbourhood Radio</li>\r\n                </ul>\r\n            </li>\r\n            <li class="clearfix"></li>\r\n                        \r\n            <li class="logout btn danger">Logout</li>\r\n        </ul>\r\n    </form>    \r\n',d}function p(a,b){return"off"}function q(a,b){return'<span class="notice">Some stations available for subscribers only</span>'}function r(a,b){return"subscribe"}function s(a,b){return'\r\n<form class="form login" onsubmit="return false">\r\n    <div class="logo"></div>\r\n    <ul>            \r\n        <li>\r\n            <label>Username <span class="error" style="display:none">Wrong credentials</span></label>\r\n            <input name="username" autofocus/>\r\n        </li>\r\n        <li>\r\n            <label>Password</label>\r\n            <input type="password" name="password" />\r\n        </li>\r\n        <li class="buttons">\r\n            <input type="submit" value="Login" class="btn" />\r\n        </li>\r\n    </ul>\r\n</form>\r\n'}c=c||a.helpers;var f="",g,h,i,j=this,k="function",l=c.helperMissing,m=void 0,n=this.escapeExpression;f+='<header>\r\n    <a class="back"></a>\r\n    <h3>Last.FM</h3>\r\n</header>\r\n',g=c.logged||b.logged,h=c["if"],i=j.program(1,o,e),i.hash={},i.fn=i,i.inverse=j.program(8,s,e),g=h.call(b,g,i);if(g||g===0)f+=g;return f})}(),function(){var a,b,c=Object.prototype.hasOwnProperty;b=function(a){var b,d,e;d=[];for(b in a){if(!c.call(a,b))continue;e=a[b],d.push(""+b+"="+e)}return d.join("&")},a={settings:{baseURL:"http://ws.audioscrobbler.com/2.0/",format:"json",api_key:"48e602d0f8c4d34f00b1b17d96ab88c1",api_secret:"c129f28ec70abc4311b21fa8473d34e7"},getSignature:function(b){var d,e,f;e=[];for(d in b){if(!c.call(b,d))continue;f=b[d],d!=="format"&&e.push(d+f)}return e.sort(),MD5(e.join("")+a.settings.api_secret)},getSession:function(){return browser.isPokki?pokki.descramble(store.get("lastfm:key")):store.get("lastfm:key")},callMethod:function(b,c,d){return c==null&&(c={}),c.format=this.settings.format,c.api_key=this.settings.api_key,c.method=b,c.sig_call&&(delete c.sig_call,b.match(/^auth/)||(c.sk=a.getSession()),c.api_sig=this.getSignature(c)),$.ajax({url:""+this.settings.baseURL,data:c,cache:!0,dataType:this.settings.format,success:function(a){return console.log("Lastfm response:",a),d(a)},error:function(a){return d({error:"asd"})}})},convertDateToUTC:function(a){return a==null&&(a=new Date),new Date(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate(),a.getUTCHours(),a.getUTCMinutes(),a.getUTCSeconds())},fakePostRequest:function(a,b){var d,e,f,g,h;e=document.createElement("iframe"),e.name=e.id=+(new Date),document.body.appendChild(e),d=document.createElement("form"),d.action=a,d.method="post",d.target=e.id;for(g in b){if(!c.call(b,g))continue;h=b[g],f=document.createElement("input"),f.name=g,f.value=h,d.appendChild(f)}return document.body.appendChild(d),d.submit(),setTimeout(function(){return document.body.removeChild(e),document.body.removeChild(d)},2e3)},track:{scrobble:function(b,c){var d;return b.method="track.scrobble",b.timestamp=+(new Date)/1e3|0,b.sk=a.getSession(),b.api_key=a.settings.api_key,d=a.getSignature(b),b.api_sig=d,a.fakePostRequest(""+a.settings.baseURL,b)},updateNowPlaying:function(b,c){var d;return b.method="track.updateNowPlaying",b.sk=a.getSession(),b.api_key=a.settings.api_key,d=a.getSignature(b),b.api_sig=d,a.fakePostRequest(""+a.settings.baseURL,b)},search:function(b,c){return a.callMethod("track.search",{track:b},function(a){var b;return c((b=a.results.trackmatches)!=null?b.track:void 0)})}},artist:{search:function(b,c){return a.callMethod("artist.search",{artist:b},function(a){var b;return c((b=a.results.artistmatches)!=null?b.artist:void 0)})},getTopTracks:function(b,c){return a.callMethod("artist.getTopTracks",{artist:b},function(a){var b;return b=a.toptracks.track,b=_.map(b,function(a){return{artist:a.artist.name,song:a.name,duration:parseInt(a.duration),images:a.image}}),c(b)})}},album:{search:function(b,c){return a.callMethod("album.search",{album:b},function(a){var b;return c((b=a.results.albummatches)!=null?b.album:void 0)})},getInfo:function(b,c,d){return a.callMethod("album.getInfo",{album:c,artist:b},function(a){var b;return b=a.album.tracks.track,b=_.map(b,function(a){return{artist:a.artist.name,song:a.name,duration:parseInt(a.duration),images:a.images}}),d(b)})}},image:function(b){var c,d,e;if(!b.artist)return;return(e=b.size)==null&&(b.size="mediumsquare"),d=[],b.album?(c="album",d.push("album="+encodeURIComponent(b.album))):(c="artist",d.push("artist="+encodeURIComponent(b.artist))),""+a.settings.baseURL+"?api_key="+a.settings.api_key+"&method="+c+".getImageRedirect&size="+b.size+"&"+d.join("&")},radio:{getPlaylist:function(b){return a.callMethod("radio.getPlaylist",{sig_call:!0},function(a){var c;return c=a.playlist.trackList.track,c=_.map(c,function(b){return{artist:b.creator,song:b.title,file_url:b.location,images:[b.image],duration:b.duration/1e3,lastfm_radio:!0,type:"lastfm:stream_track",source_title:a.playlist.title,source_icon:"http://cdn.last.fm/flatness/favicon.2.ico"}}),c.push({song:"Load next tracks",artist:"",type:"lastfm:radio_loader",action:!0}),b(c)})},tune:function(b,c){var d,e;return b.match(/loved$/)?(a._station="loved",c()):(d={station:b},d.method="radio.tune",d.sk=a.getSession(),d.api_key=a.settings.api_key,e=a.getSignature(d),d.api_sig=e,d.format="json",d._url=""+a.settings.baseURL,d._method="POST",$.ajax({url:""+chromus.baseURL+"/proxy?_callback=?",data:d,dataType:"jsonp",cache:!0,success:function(a){return a=JSON.parse(a.response),a.error?browser.postMessage({method:"lastfm:error",error:a.error.code}):c()}}))}}},this.chromus.registerPlugin("lastfm",a)}.call(this),function(){var a,b,c,d,e=Object.prototype.hasOwnProperty,f=function(a,b){function d(){this.constructor=a}for(var c in b)e.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};c=chromus.plugins.lastfm,b=function(){function a(){a.__super__.constructor.apply(this,arguments)}return f(a,Backbone.View),a.prototype.className="lastfm",a.prototype.events={"submit form.login":"login","click .logout":"logout","click .toggler":"toggleScrobbling","click .lastfm_radio":"playRadio","click .loved_radio":"playLovedRadio"},a.prototype.initialize=function(){return chromus.openPanel(this.el),this.render()},a.prototype.render=function(){var a;return a={logged:!!c.getSession(),scrobbling:!!store.get("lastfm:scrobbling"),user:store.get("lastfm:user"),subscriber:!!parseInt(store.get("lastfm:subscriber"))},this.el.innerHTML=Handlebars.templates["lastfm.ui.tmpl"](a),this.delegateEvents()},a.prototype.logout=function(){return store.remove("lastfm:user"),store.remove("lastfm:key"),this.render()},a.prototype.toggleScrobbling=function(){return store.set("lastfm:scrobbling",!store.get("lastfm:scrobbling")),this.$(".toggler").toggleClass("off",!store.get("lastfm:scrobbling"))},a.prototype.playRadio=function(a){var b;return b={type:"lastfm:radio",artist:"LastFM radio",song:"Loading...",station:$(a.target).attr("data-radio")},browser.postMessage({method:"play",track:b,playlist:[b]}),chromus.closePanel()},a.prototype.playLovedRadio=function(a){var b;return b={type:"lastfm:loved",artist:"LastFM Loved radio (free)",song:"Loading..."},browser.postMessage({method:"play",track:b,playlist:[b]}),chromus.closePanel()},a.prototype.login=function(a){var b,d,e,f,g,h=this;return d=a.target,g=[d.username.value,d.password.value],f=g[0],e=g[1],this.$(".login *").css({visibility:"hidden"}),this.spinner=(new Spinner).spin(this.el),b=MD5(f+MD5(e)),c.callMethod("auth.getMobileSession",{sig_call:!0,username:f,authToken:b},function(a){h.$(".login *").css({visibility:"visible"});if(a.error)return h.$(".error").show(),h.spinner.stop();if(a.session)return store.set("lastfm:user",a.session.name),store.set("lastfm:subscriber",parseInt(a.session.subscriber)),browser.isPokki?store.set("lastfm:key",pokki.scramble(a.session.key)):store.set("lastfm:key",a.session.key),store.set("lastfm:scrobbling",!0),h.render()}),a.stopPropagation()},a}(),a=function(){function a(){a.__super__.constructor.apply(this,arguments)}return f(a,Backbone.View),a.prototype.tagName="li",a.prototype.className="lastfm",a.prototype.events={click:"openPanel"},a.prototype.initialize=function(){return this.container=$("#main_menu"),this.render()},a.prototype.render=function(){return this.el.innerHTML="Last.FM",this.delegateEvents()},a.prototype.openPanel=function(){return new b,$("#main_menu").hide()},a}(),d=new a,chromus.addMenu(d.el),browser.addMessageListener(function(a){switch(a.method){case"lastfm:error":return error_window.render()}})}.call(this),function(){var a,b;b=this,a={APP_ID:b.debug?"2649785":"2698877",SCOPE:"audio,offline",authURL:function(){var b,c,d,e;return browser.isChrome?b=""+chromus.baseURL+"/chromus/index.html":b=document.location.toString(),d=chromus.plugins_info.vkontakte.path,d=d.replace(/chrome-extension:\/\/\w+\//,""),e=[b,"/../",d,"/oauth.html"].join(""),c=["http://api.vkontakte.ru/oauth/authorize?","client_id="+a.APP_ID,"scope="+a.SCOPE,"redirect_uri="+e,"display=popup","response_type=token"].join("&")},searchWithoutLogin:function(b,c){return $.ajax({url:""+chromus.baseURL+"/api/token/get",dataType:"jsonp",success:function(d){if(!d.error)return b.access_token=d.token,a.searchAPI(b,c)}})},searchAPI:function(a,b){var c,d;return console.warn("searching as logged user"),d=""+a.artist+" "+a.song,c={q:d,format:"json",sort:2,count:10},a.access_token?c.access_token=a.access_token:browser.isPokki?c.access_token=pokki.descrumble(store.get("vk:token")):c.access_token=store.get("vk:token"),$.ajax({url:"https://api.vkontakte.ru/method/audio.search",data:c,dataType:"jsonp",cache:!0,success:function(a){var c;return a.response?(c=_.map(_.rest(a.response),function(a){return{artist:a.artist,song:a.title,duration:parseInt(a.duration),file_url:a.url,source_title:"Vkontakte",source_icon:"http://vkontakte.ru/favicon.ico"}}),b(c)):b([])}})},search:function(b,c){return store.get("vk:user_id")?a.searchAPI(b,c):a.searchWithoutLogin(b,c)}},this.chromus.registerPlugin("vkontakte",a),this.chromus.registerAudioSource("vkontakte",a),browser.addMessageListener(function(a,b,c){switch(a.method){case"vk:auth":return store.set("vk:token",a.auth.access_token),store.set("vk:user_id",a.auth.user_id),$.ajax({url:""+chromus.baseURL+"/api/token/add",data:{token:a.auth.access_token},dataType:"jsonp",success:function(a){return console.log("token added")}}),console.warn("logged!")}})}.call(this),function(){var a=Handlebars.template,b=Handlebars.templates=Handlebars.templates||{};b["vkontakte.ui.tmpl"]=a(function(a,b,c,d,e){function k(a,b){return'        \t\t\r\n\t<ul>\r\n\t\t<li>\r\n\t\t\t<h3 style="font-size:20px; font-weight: bold; margin-bottom: 10px;">Logged!</h3>\r\n\t\t\t<p style="font-size: 14px;">Rest of functionality will be available in next update. Stay tuned!</p>\r\n\t\t</li>\r\n\t\t<li>\r\n\t\t\t<a class="btn logout" style="color: red">Logout</a>\r\n\t\t</li>\r\n\t</ul>       \t\r\n    '}function l(a,b){return'    \r\n\t<ul>\r\n\t\t<li style="text-align: center">\r\n\t\t\t<a class="btn login">Login to Vkontakte</a>\r\n\t\t</li>\r\n\t</ul>\r\n    '}c=c||a.helpers;var f="",g,h,i,j=this;f+='<header>\r\n    <a class="back"></a>\r\n    <h3>Vkontakte</h3>\r\n</header>\r\n<form class="form">\r\n\t<div class="logo"></div>\r\n    ',g=c.logged||b.logged,h=c["if"],i=j.program(1,k,e),i.hash={},i.fn=i,i.inverse=j.program(3,l,e),g=h.call(b,g,i);if(g||g===0)f+=g;return f+="\r\n</form>",f})}(),function(){var a,b,c,d,e=Object.prototype.hasOwnProperty,f=function(a,b){function d(){this.constructor=a}for(var c in b)e.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};d=chromus.plugins.vkontakte,a=function(){function a(){a.__super__.constructor.apply(this,arguments)}return f(a,Backbone.View),a.prototype.template=Handlebars.templates["vkontakte.ui.tmpl"],a.prototype.className="vkontakte",a.prototype.events={"click .login":"login","click .logout":"logout"},a.prototype.initialize=function(){return _.bindAll(this),this.render(),window.setVKSession=this.setSession},a.prototype.open=function(){return chromus.openPanel(this.el)},a.prototype.render=function(){var a;return a={logged:!!store.get("vk:token")},$(this.el).html(this.template(a)),this.delegateEvents()},a.prototype.setSession=function(a){return store.set("vk:token",a.access_token),store.set("vk:user_id",a.user_id),$.ajax({url:""+chromus.baseURL+"/api/token/add",data:{token:a.access_token},dataType:"jsonp",success:function(a){return console.log("token added")}}),this.render()},a.prototype.login=function(){return window.open(d.authURL(),"Vkontakte","status=0,toolbar=0,location=0,menubar=0,resizable=1")},a.prototype.logout=function(){return $.ajax({url:""+chromus.baseURL+"/api/token/delete",data:{token:store.get("vk:token")},dataType:"jsonp",success:function(a){return console.log("token removed")}}),store.remove("vk:token"),store.remove("vk:user_id"),this.render()},a}(),c=new a,b=$('<li class="vkontakte">Vkontakte</li>').bind("click",function(){return $("#main_menu").hide(),console.warn(c.open,c),c.open()}),chromus.addMenu(b)}.call(this),function(){var a=Handlebars.template,b=Handlebars.templates=Handlebars.templates||{};b["about.ui.tmpl"]=a(function(a,b,c,d,e){function k(a,b){return'checked="checked"'}c=c||a.helpers;var f="",g,h,i,j=this;f+='<header>\r\n    <a class="back"></a>\r\n    <h3>About</h3>\r\n</header>\r\n<div style="margin-top:20px; text-align:center">\r\n    <h1 style="background:url(assets/icons/42x42.png) center left no-repeat; font-weight: bold; font-size: 16px; display: inline-block; line-height: 42px; padding-left: 50px">Chromus v3.0.2</h1>\r\n\r\n    <a href="https://github.com/chromus/chromus" style="display:block;margin-top:15px; font-size: 14px;" target="_blank">github</a>\r\n\r\n    <div>\r\n        <label><input type="checkbox" name="debug" ',g=c.debug||b.debug,h=c["if"],i=j.program(1,k,e),i.hash={},i.fn=i,i.inverse=j.noop,g=h.call(b,g,i);if(g||g===0)f+=g;return f+="/> Debug mode</label>            \r\n    </div>\r\n</div>",f})}(),function(){var a,b,c=Object.prototype.hasOwnProperty,d=function(a,b){function e(){this.constructor=a}for(var d in b)c.call(b,d)&&(a[d]=b[d]);return e.prototype=b.prototype,a.prototype=new e,a.__super__=b.prototype,a};a=function(){function a(){a.__super__.constructor.apply(this,arguments)}return d(a,Backbone.View),a.prototype.template=Handlebars.templates["about.ui.tmpl"],a.prototype.events={"change input[name='debug']":"toggleDebug"},a.prototype.initialize=function(){return chromus.openPanel(this.el),this.render()},a.prototype.render=function(){var a;return a={debug:store.get("debug")},this.el.innerHTML=this.template(a)},a.prototype.toggleDebug=function(a){return localStorage.setItem("debug",a.target.checked)},a}(),b=$("<li>About</li>").bind("click",function(){return $("#main_menu").hide(),new a}),chromus.addMenu(b)}.call(this),yepnope({load:["css!./lib/jasmine/jasmine.css","css!./plugins/lastfm/lastfm.css","css!./plugins/vkontakte/vkontakte_style.css"]})